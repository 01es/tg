<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/components/moment-component.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/polymer/iron-icons/iron-icons.html">
<link rel="import" href="/resources/polymer/iron-media-query/iron-media-query.html">
<link rel="import" href="/resources/components/tg-time.html">
<link rel="import" href="/resources/components/tg-month-selector.html">
<link rel="import" href="/resources/components/tg-year-selector.html">
<link rel="import" href="/app/tg-app-config.html">
<link rel="import" href="/resources/polymer/neon-animation/neon-animated-pages.html">
<link rel="import" href="/resources/polymer/neon-animation/neon-animation.html">


<dom-module id="tg-calendar">
	<style>
		.col {
			width: 14em;
		}
        .day-name {
			background-color: #0288D1;
			color: white;
		}
		.header {
			height: 2.2em;
			font-size: 14px;
		}
		.selected-date {
			background-color: #03A9F4;
			color: white !important;
		}
		
		.selected-month {
			font-size: 24px;
		}
		
		.selected-day {
			font-size: 56px;
		}
		
		.selected-year {
			font-size: 24px;
			color: #81D4FA;
		}
		tg-time {
			background-color: #03A9F4;
			color: white;
			--tg-time: {
				font-size: 14px;
				height: 14px;
			};
			--tg-time-portion: {
				margin: 8px 0px;
			};
			--tg-meridian: {
				font-size: 14px;
				height: 14px;
			};
		}
	</style>
	<template>
		<tg-app-config id="appConfig"></tg-app-config>
		<iron-media-query query="[[_calcMobileQuery()]]" query-matches="{{_phoneScreen}}"></iron-media-query>
		<div class$="[[_calcCalendarLayout(_phoneScreen)]]">
			<div class="col layout vertical">
				<div class="header day-name layout vertical center-center">[[dayName]]</div>
				<div class="selected-date layout vertical center justified" style="padding: 10px;">
					<div class="selected-month">[[monthName]]</div>
					<div class="selected-day">[[day]]</div>
					<div class="selected-year">[[year]]</div>
				</div>
				<template is="dom-if" if="[[pickTime]]">
					<tg-time hour="{{selectedHour}}" minute="{{selectedMinute}}"></tg-time>
				</template>
			</div>
			<div class="col relative">
                <neon-animated-pages class="fit" id="pages" selected=[[_selectedPage]] attr-for-selected="page-name" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
                    <tg-month-selector page-name="monthSelector"></tg-month-selector>
                    <tg-year-selector page-name="yearSelector"></tg-year-selector>
                </neon-animated-pages>
			</div>
		</div>
	</template>
</dom-module>
<script>
	(function () {
		Polymer({

			is: "tg-calendar",

			properties: {
				selectedDate: {
					type: Number,
					notify: true,
					observer: "_selectedDateChanged"
				},
				selectedHour: {
					type: Number,
					notify: true
				},
				selectedMinute: {
					type: Number,
					notify: true
				},
				pickTime: {
					type: Boolean,
					reflectToAttribute: true,
					value: false
				}
			},


			attached: function () {
				var shownDate = (this.selectedDate && new Date(this.selectedDate)) || new Date();
				this._adjustDate(shownDate);
			},
            
			/**
			 * Updates the calendar information according to specified date.
			 */
			_adjustDate: function (date) {
				this.dayName = moment(date).format("dddd");
				this.monthName = moment(date).format("MMM").toUpperCase();
				this.day = date.getDate();
				this.year = date.getFullYear();
			},

			/**
			 * Listens when the selected date changes.
			 */
			_selectedDateChanged: function (newValue, oldValue) {
				var newDate = new Date(newValue);
				this._adjustDate(newDate);
			},

			/**
			 * Calculates the media query for mobile devices.
			 */
			_calcMobileQuery: function () {
				return "max-width: " + (this.$.appConfig.minTabletWidth - 1) + "px";
			},

			/**
			 * Calculates the calendar layout depending on phoneScreen.
			 */
			_calcCalendarLayout: function (phoneScreen) {
				return "layout " + (phoneScreen ? "vertical" : "horizontal");
			}
        });
	})();
</script>