<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/resources/master/actions/tg-abstract-action.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">

<polymer-element name="tg-action" attributes="action onAction" extends="tg-abstract-action">
    <template>
        <shadow></shadow>
        <paper-button id="actionButton" raised roll="button" on-tap="{{run}}" disabled?="{{!isEnabled(enabledStates, currentState, enabled)}}">{{shortDesc}}</paper-button>
    </template>
    <script>
        Polymer('tg-action', {
            publish: {
                /**
                 * Custom function to be invoked during run() of this action.
                 */
                action: null,
                /**
                 * Custom function to be invoked after run() of this action has been executed.
                 */
                onAction: null
            },

            onActionUpgraded: false,

            /**
             * Initialisation block.
             */
            ready: function () {
                var self = this;
                self.super();
            },            

            /**
             * Executes the action.
             */
            run: function() {
            	this.super();
                this.action();
            },

            onActionChanged: function(oldValue, newValue) {
                var self = this;
                console.log("onAction changed, old = ", oldValue, newValue);
                if (newValue && !self.onActionUpgraded) {
                    self.onAction = function(smth) {
                        newValue(smth);
                        self.afterExecution();
                    };
                    self.onActionUpgraded = true;
                }
            }
        });
    </script>
</polymer-element>