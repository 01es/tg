<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/slide-up.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/scale-up.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/tile-cascade.html">
<link rel="import" href="/resources/views/tg-app-menu.html">
<link rel="import" href="/resources/views/tg-app-view.html">

<polymer-element name="tg-app" attributes="user" layout vertical>
    <template>

        <core-animated-pages id="pages" selected="{{selected}}" transitions="cross-fade cross-fade-delayed scale-up slide-up slide-up-offscreen slide-down tile-cascade hero-transition" flex on-core-animated-pages-transition-end="{{pageAnimated}}">

            <tg-app-menu id="menu" name="menu" user="{{user}}" items="{{views.items}}" whenDesktop="{{views.whenDesktop}}" whenTablet="{{views.whenTablet}}" whenMobile="{{views.whenMobile}}" minCellHeight="{{views.minCellHeight}}" minCellWidth="{{views.minCellWidth}}" fit></tg-app-menu>

            <template repeat="{{view in views.items}}">
                <tg-app-view item="{{view}}" name="{{view.name}}" hero-id="{{'hero_' + view.name}}" hero?="{{selectedMenuItem.name === view.name}}" fit></tg-app-view>
            </template>

        </core-animated-pages>
    </template>
    <script>
        (function () {

            Polymer({
                eventDelegates: {
                    'main-menu': 'showMainMenu',
                    'menu-item-selected': 'showView'
                },
                showMainMenu: function (e) {
                    this.lastSelected = this.selected;
                    this.selected = "menu";
                },
                showView: function (e) {
                    var state
                    if (this.lastSelected && this.lastSelected !== e.detail) {
                        state = [this.lastSelected];
                        console.log('pushed state'  + state);
                        history.pushState([this.lastSelected]);
                    }
                    this.selected = e.detail;
                },
                pageAnimated: function (e, detail, source) {
                    if (this.selected !== "menu") {
                        this.$.pages.selectedItem.play();
                    }
                },
                ready: function () {
                    this.views = {
                        whenDesktop: [
                            [[{
                                rowspan: 2,
                                colspan: 2
                            }], [], [], [{
                                colspan: 2
                            }]],
                            [[{
                                rowspan: 2,
                                colspan: 2
                            }], [], []],
                            [[], [], [], []]
                        ],
                        whenTablet: [
                            [[{
                                rowspan: 2,
                                colspan: 2
                            }], [], []],
                            [[{
                                rowspan: 2,
                                colspan: 2
                            }]],
                            [[], []],
                            [[{
                                rowspan: 2,
                                colspan: 2
                            }], [], []],
                            [[], []],
                        ],
                        whenMobile: [
                            [[], []],
                            [[], []],
                            [[], []],
                            [[], []],
                            [[], []],
                            [[]],
                        ],
                        minCellHeight: "100px",
                        minCellWidth: "100px",
                        items: [
                            {
                                name: "view 1",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 2",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white",
                                menu: [
                                    {
                                        name: "view 1"
                                    },
                                    {
                                        name: "view 2",
                                        submenu: [
                                            {
                                                name: "view 1"
                                            },
                                            {
                                                name: "view 2"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                name: "view 3",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 4",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 5",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 6",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 7",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 8",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 9",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 10",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            },
                            {
                                name: "view 11",
                                icon: "/resources/images/test.svg",
                                theme: "#f4f4f4",
                                nameTheme: "#999999",
                                textTheme: "white"
                            }
                        ]
                    };
                    this.selected = this.views.items[0].name;
                    window.onpopstate = function(e) {
                        console.log("poped state ", history.state);
                    }.bind(this);
                }
            });
        })();
    </script>
</polymer-element>