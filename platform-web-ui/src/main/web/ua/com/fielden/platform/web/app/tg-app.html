<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/neon-animated-pages.html">
<link rel="import" href="/resources/polymer/neon-animations.html">
<link rel="import" href="/resources/views/tg-app-menu.html">
<link rel="import" href="/resources/views/tg-app-view.html">
<link rel="import" href="/resources/components/postal-lib.html">
<link rel="import" href="/resources/app/tg-view-manager.html">

<dom-module id="tg-app">
    <style>
        :host {
            overflow: hidden;
        }
    </style>
    <template>
        <tg-view-manager></tg-view-manager>
        <neon-animated-pages id="pages" attrForSelected="name">
            <tg-app-menu class="fit" name="menu" menu-config="[[menuConfig]]"></tg-app-menu>
            <template is="dom-repeat" items="[[menuConfig.items]]">
                <tg-app-view class="fit" menu-item="{{view}}" hero-id="hero"></tg-app-view>
            </template>
        </neon-animated-pages>
    </template>
</dom-module>

<script>
    (function () {
        var pushState = function (state) {
                if (state && Array.isArray(state) && state.length > 0) {
                    postal.publish({
                        channel: state[0],
                        topic: "state.push",
                        data: {
                            state: state
                        }
                    });
                }
            },
            popState = function (state) {
                if (state && Array.isArray(state) && state.length > 0) {
                    postal.publish({
                        channel: state[0],
                        topic: "state.pop",
                        data: {
                            state: state,
                        }
                    });
                }
            };
        Polymer({

            is: "tg-app",

            listeners: {
                "main-menu": "_showMainMenu",
                "menu-item-selected": "_showView"
            },
            _showMainMenu: function (e) {
                this._setSelected("menu");
            },
            _showView: function (e) {
                pushState([e.detail]);
            },
            _setSelected: function (selected) {
                this.$.pages.selected = selected;
            },
            ready: function () {
                var self = this;
                this.menuConfig = {
                    whenDesktop: [[[{
                        rowspan: 2,
                        colspan: 2
                    }], [], [], [{
                        colspan: 2
                    }]], [[{
                        rowspan: 2,
                        colspan: 2
                    }], [], []], [[], [], [{
                        colspan: 2
                    }]]],
                    whenTablet: [[[{
                        rowspan: 2,
                        colspan: 2
                    }], [], []], [[{
                        rowspan: 2,
                        colspan: 2
                    }]], [[], []], [[{
                        rowspan: 2,
                        colspan: 2
                    }], [], []], [[{
                        colspan: 2
                    }]]],
                    whenMobile: [[[], []], [[], []], [[], []], [[], []], [[], []]],
                    minCellWidth: '100px',
                    minCellHeight: '148px',
                    items: [{
                        title: "Fleet",
                        descritpion: "Fleet",
                        bgColor: "#00D4AA",
                        captionBgColor: "#00AA88",
                        icon: "/resources/images/fleet.svg",
                        detailIcon: "/resources/images/detailed/fleet.svg",
                        view: null
                    }, {
                        title: "Import utilities",
                        descritpion: "Import utilities",
                        bgColor: "#5FBCD3",
                        captionBgColor: "#2C89A0",
                        icon: "/resources/images/importUtilities.svg",
                        detailIcon: "/resources/images/detailed/importUtilities.svg",
                        view: null
                    }, {
                        title: "Division daily management",
                        descritpion: "Division daily management",
                        bgColor: "#CFD8DC",
                        captionBgColor: "#78909C",
                        icon: "/resources/images/divisionalDailyManagment.svg",
                        detailIcon: "/resources/images/detailed/divisionalDailyManagment.svg",
                        view: null
                    }, {
                        title: "Accidents",
                        descritpion: "Accidents",
                        bgColor: "#FF9943",
                        captionBgColor: "#C87137",
                        icon: "/resources/images/accidents.svg",
                        detailIcon: "/resources/images/detailed/accidents.svg",
                        view: null
                    }, {
                        title: "Maintenance",
                        descritpion: "Maintenance",
                        bgColor: "#00AAD4",
                        captionBgColor: "#0088AA",
                        icon: "/resources/images/maintanance.svg",
                        detailIcon: "/resources/images/detailed/maintanance.svg",
                        view: null
                    }, {
                        title: "User",
                        descritpion: "User",
                        bgColor: "#FFE680",
                        captionBgColor: "#FFD42A",
                        icon: "/resources/images/user.svg",
                        detailIcon: "/resources/images/detailed/user.svg",
                        view: null
                    }, {
                        title: "Online reports",
                        descritpion: "Online reports",
                        bgColor: "#00D4AA",
                        captionBgColor: "#00AA88",
                        icon: "/resources/images/onlineReports.svg",
                        detailIcon: "/resources/images/detailed/onlineReports.svg",
                        view: null
                    }, {
                        title: "Fuel",
                        descritpion: "Fuel",
                        bgColor: "#FFE680",
                        captionBgColor: "#FFD42A",
                        icon: "/resources/images/fuel.svg",
                        detailIcon: "/resources/images/detailed/fuel.svg",
                        view: null
                    }, {
                        title: "Organisational",
                        descritpion: "Organisational",
                        bgColor: "#2AD4F6",
                        captionBgColor: "#00AAD4",
                        icon: "/resources/images/organisational.svg",
                        detailIcon: "/resources/images/detailed/organisational.svg",
                        view: null
                    }, {
                        title: "Preventive maintenance",
                        descritpion: "Preventive maintenance",
                        bgColor: "#F6899A",
                        captionBgColor: "#D35F5F",
                        icon: "/resources/images/preventiveMaintenence.svg",
                        detailIcon: "/resources/images/detailed/preventiveMaintenence.svg",
                        view: null
                    }]
                };
                postal.subscribe({
                    channel: "app",
                    topic: "state.pushed",
                    callback: function (data, envelope) {
                        self._setSelected(data.state[0]);
                        //updateHash(data.state);
                    }
                });
                postal.subscribe({
                    channel: "app",
                    topic: "state.poped",
                    callback: function (data, envelope) {
                        self._setSelected(data.state[0]);
                    }
                });
                //Set up listener for history events
                window.onpopstate = function (e) {
                    popState(e.state);
                };
                //Selectes the first view 
                self._setSelected("menu");
                history.pushState(["menu"], "");
            }
        });
    })();
</script>