<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/paper-material/paper-material.html">
<link rel="import" href="/resources/polymer/paper-checkbox/paper-checkbox.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/polymer/iron-icon/iron-icon.html">
<link rel="import" href="/resources/polymer/iron-icons/iron-icons.html">

<dom-module id="egi-comp-spike">
    <template>
        <paper-material elevation="1" style="margin: 10px 10px;">
                <div class="layout vertical data-table">
                    <!--Table toolbar-->
                    <div class="grid-toolbar layout horizontal justified" hidden$="[[!toolbarVisible]]">
                        <div class="layout horizontal center">
                            <content select=".entity-specific-action"></content>
                        </div>
                        <div class="layout horizontal center">
                            <content select=".standart-action"></content>
                        </div>
                    </div>
                    <!-- Table header -->
                    <div class="layout horizontal table-header-row">
                        <div class="table-cell layout horizontal center" hidden$="[[!checkboxVisible]]" tooltip-text$="[[_selectAllTooltip(selectedAll)]]">
                            <paper-checkbox class="blue header" checked="[[selectedAll]]" on-change="_allSelectionChanged"></paper-checkbox>
                        </div>
                        <template is="dom-if" if="[[primaryAction]]">
                            <div class="table-cell layout horizontal center" style="width:40px">
                                <!--Primary action stub header goes here-->
                            </div>
                        </template>
                        <template is="dom-repeat" items="[[columns]]">
                            <div class="table-cell layout horizontal center-center" style$="[[_calcColumnHeaderStyle(item)]]" tooltip-text$="[[item.columnDesc]]">
                                <div class="truncate" style$="[[_calcColumnHeaderStyle(item)]]">[[item.columnTitle]]</div>
                            </div>
                        </template>
                        <template is="dom-if" if="[[_isSecondaryActionsPresent(secondaryActions)]]">
                            <div class="table-cell layout horizontal center" style="width:40px">
                                <!--Secondary actions header goes here-->
                            </div>
                        </template>
                    </div>
                    <!-- Table body -->
                    <template is="dom-repeat" items="[[egiModel]]" as="egiEntity" index-as="entityIndex">
                        <div class="layout horizontal table-data-row" selected$="[[egiEntity.selected]]">
                            <div class="table-cell layout horizontal center" hidden$="[[!checkboxVisible]]" tooltip-text$="[[_selectTooltip(egiEntity.selected)]]">
                                <paper-checkbox class="blue body" checked="[[egiEntity.selected]]" on-change="_selectionChanged"></paper-checkbox>
                            </div>
                            <template is="dom-if" if="[[primaryAction]]">
                                <div class="table-cell layout horizontal center">
                                    <tg-page-action icon="[[primaryAction.icon]]" action="[[primaryAction.action]]" current-entity="[[egiEntity.entity]]" hidden$="[[!primaryAction.action]]" element-name="[[primaryAction.elementName]]" attrs="[[primaryAction.attrs]]" component-uri="[[primaryAction.componentUri]]" view-type="[[primaryAction.viewType]]" should-refresh-parent-centre-after-save="[[primaryAction.shouldRefreshParentCentreAfterSave]]" pref-dim="[[primaryAction.prefDim]]"></tg-page-action>
                                    <tg-ui-action show-dialog="[[primaryAction.showDialog]]" current-entity="[[egiEntity.entity]]" hidden$="[[primaryAction.action]]" short-desc="[[primaryAction.shortDesc]]" long-desc="[[primaryAction.longDesc]]" icon="[[primaryAction.icon]]" component-uri="[[primaryAction.componentUri]]" element-name="[[primaryAction.elementName]]" attrs="[[primaryAction.attrs]]" create-context-holder="[[primaryAction.createContextHolder]]" require-selection-criteria="[[primaryAction.requireSelectionCriteria]]" require-selected-entities="[[primaryAction.requireSelectedEntities]]" require-master-entity="[[primaryAction.requireMasterEntity]]" pre-action="[[primaryAction.preAction]]" post-action-success="[[primaryAction.postActionSuccess]]" post-action-error="[[primaryAction.postActionError]]" should-refresh-parent-centre-after-save="[[primaryAction.shouldRefreshParentCentreAfterSave]]"  ui-role="[[primaryAction.uiRole]]"></tg-ui-action>
                                </div>
                            </template>
                            <template is="dom-repeat" items="[[columns]]" as="column">
                                <div class="table-data-cell relative layout horizontal center" style$="[[_calcColumnStyle(column)]]" on-tap="_tapAction" tooltip-text$="[[_getTooltip(egiEntity.entity, column)]]">
                                    <div class="fit" style$="[[_calcRenderingHintsStyle(egiEntity, entityIndex, column.property)]]">
                                    </div>
                                    <template is="dom-if" if="[[_isBooleanProp(egiEntity.entity, column)]]">
                                        <iron-icon class="table-icon" icon="[[_getBooleanIcon(egiEntity.entity, column.property)]]"></iron-icon>
                                    </template>
                                    <template is="dom-if" if="[[_isNotBooleanProp(egiEntity.entity, column)]]">
                                        <div class="truncate relative" style$="[[_calcColumnStyle(column)]]">[[_getValue(egiEntity.entity, column.property, column.type)]]</div>
                                    </template>
                                </div>
                            </template>
                            <template is="dom-if" if="[[_isSecondaryActionsPresent(secondaryActions)]]">
                                <div class="table-cell layout horizontal center">
                                    <template is="dom-if" if="[[_isOnlyOneSecondaryActions(secondaryActions)]]">
                                        <tg-page-action icon="[[secondaryActions.0.icon]]" action="[[secondaryActions.0.action]]" current-entity="[[egiEntity.entity]]" hidden$="[[!secondaryActions.0.action]]" element-name="[[secondaryActions.0.elementName]]" attrs="[[secondaryActions.0.attrs]]" component-uri="[[secondaryActions.0.componentUri]]" view-type="[[secondaryActions.0.viewType]]" should-refresh-parent-centre-after-save="[[secondaryActions.0.shouldRefreshParentCentreAfterSave]]" pref-dim="[[secondaryActions.0.prefDim]]"></tg-page-action>
                                        <tg-ui-action show-dialog="[[secondaryActions.0.showDialog]]" current-entity="[[egiEntity.entity]]" hidden$="[[secondaryActions.0.action]]" short-desc="[[secondaryActions.0.shortDesc]]" long-desc="[[secondaryActions.0.longDesc]]" icon="[[secondaryActions.0.icon]]" component-uri="[[secondaryActions.0.componentUri]]" element-name="[[secondaryActions.0.elementName]]" attrs="[[secondaryActions.0.attrs]]" create-context-holder="[[secondaryActions.0.createContextHolder]]" require-selection-criteria="[[secondaryActions.0.requireSelectionCriteria]]" require-selected-entities="[[secondaryActions.0.requireSelectedEntities]]" require-master-entity="[[secondaryActions.0.requireMasterEntity]]" pre-action="[[secondaryActions.0.preAction]]" post-action-success="[[secondaryActions.0.postActionSuccess]]" post-action-error="[[secondaryActions.0.postActionError]]"  should-refresh-parent-centre-after-save="[[secondaryActions.0.shouldRefreshParentCentreAfterSave]]"  ui-role="[[secondaryActions.0.uiRole]]"></tg-ui-action>
                                    </template>
                                    <template is="dom-if" if="[[!_isOnlyOneSecondaryActions(secondaryActions)]]">
                                        <tg-secondary-action-button current-entity="[[egiEntity.entity]]" actions="[[secondaryActions]]"></tg-secondary-action-button>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                    <!-- Table footer -->
                    <template is="dom-if" if="[[totals]]">
                        <template is="dom-repeat" items="[[_calcGridSummary(columns)]]" as="summaryRow" index-as="summaryRowIndex">
                            <div class="layout horizontal table-footer-row">
                                <div class="table-cell layout horizontal center" style="width:18px">
                                    <!-- checkbox stub for table footer -->
                                </div>
                                <template is="dom-if" if="[[primaryAction]]">
                                    <div class="table-cell layout horizontal center" style="width:40px">
                                        <!--Primary action footer goes here-->
                                    </div>
                                </template>
                                <template is="dom-repeat" items="[[summaryRow]]" as="summary" index-as="summaryIndex">
                                    <template is="dom-if" if="[[summary]]">
                                        <div class="table-cell layout horizontal center" style$="[[_calcColumnStyle(summary)]]">
                                            <template is="dom-if" if="[[_isBooleanProp(totals, summary)]]">
                                                <iron-icon class="table-icon" icon="[[_getBooleanIcon(totals, summary.property)]]"></iron-icon>
                                            </template>
                                            <template is="dom-if" if="[[_isNotBooleanProp(totals, summary)]]">
                                                <div class="truncate relative" style$="[[_calcColumnStyle(summary)]]">[[_getValue(totals, summary.property, summary.type)]]</div>
                                            </template>
                                        </div>
                                    </template>
                                    <template is="dom-if" if="[[!summary]]">
                                        <div class="table-cell" style$="[[_calcEmptyTotalStyle(summaryIndex, columns)]]">
                                        </div>
                                    </template>
                                </template>
                                <template is="dom-if" if="[[_isSecondaryActionsPresent(secondaryActions)]]" style="width:40px">
                                    <div class="table-cell layout horizontal center" style="width:40px">
                                        <!--Secondary actions header goes here-->
                                    </div>
                                </template>
                            </div>
                        </template>
                    </template>
                </div>
            </paper-material>
    </template>
</dom-module>
<script>
    (function () {
        Polymer({

            is: "egi-comp-spike",

            properties: {
                data: Array,
                columns: Array
            },

            ready: function () {
                var dataIndex = 0;
                var dataEntryIndex = 0;
                var dataEntry;
                //Configuring data
                this.data=[];
                for (dataIndex = 0; dataIndex < 10; dataIndex++) {
                    dataEntry = [];
                    data.push(dataEntry);
                    for (dataEntryIndex = 0; dataEntryIndex < 10; dataEntryIndex++) {
                        dataEntry.push("data entry " + dataIndex + ", " + dataEntryIndex);
                    }
                }
                //Configuring columns
                this.columns=[];
                for (dataIndex = 0; dataIndex < 10; dataIndex++) {
                    data.push("column " + dataIndex);
                }
            }
        });
    })();
</script>