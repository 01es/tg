<!doctype html>
<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>

<head>
    <title>tg-serialiser</title>

    <script src="/resources/polymer/webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="/resources/polymer/polymer-test-tools/tools.html">
    <script src="/resources/polymer/polymer-test-tools/htmltest.js"></script>

    <link rel="import" href="/resources/serialisation/tg-serialiser.html">
</head>

<body unresolved>

    <tg-serialiser id="serialiser"></tg-serialiser>

    <script>
        document.addEventListener('polymer-ready', function() {
            var serialiser = document.querySelector('#serialiser'),
                reflector = serialiser.$.reflector,
                EntityInstanceProp = reflector.getEntityInstancePropType(),
                Entity = reflector.getEntityType(),
                keyProp1 = new EntityInstanceProp(),
                descProp1 = new EntityInstanceProp(),
                keyProp2 = new EntityInstanceProp(),
                detailProp1 = new EntityInstanceProp(),
                keyProp3 = new EntityInstanceProp(),
                descProp2 = new EntityInstanceProp(),
                detailProp2 = new EntityInstanceProp(),
                keyProp4 = new EntityInstanceProp(),
                type10 = reflector.getType("4"),
                type11 = reflector.getType("11"),
                type12 = reflector.getType("12"),
                type13 = reflector.getType("13"),
                inst1 = new Entity({
                    id: 1,
                    _type: type12,
                    key: "entity key",
                    "@key": keyProp1,
                    desc: "entity description",
                    "@desc": descProp1,
                    detail: new Entity({
                        id: 2,
                        _type: type13,
                        "@key": keyProp2
                    }),
                    "@detail": detailProp1
                }),
                inst2 = new Entity({
                    id: 3,
                    _type: type12,
                    key: "entity key1",
                    "@key": keyProp3,
                    desc: "entity description1",
                    "@desc": descProp2,
                    detail: new Entity({
                        id: 4,
                        _type: type13,
                        "@key": keyProp4
                    }),
                    "@detail": detailProp2
                }),
                objToSerialise = {
                    cause: "Testing purposes",
                    ex: "No exception",
                    instance: new Entity({
                        id: null,
                        _type: type11,
                        key: "QueryRunner",
                        desc: "QueryRunner description",
                        page: new Entity({
                            id: null,
                            _type: type10,
                            key: "Page",
                            desc: "Page description",
                            numberOfPages: 1,
                            pageNo: 0,
                            results: [
                                inst1,
                                inst2
                            ],
                            summary: new Entity({
                                id: null,
                                _type: type12,
                                total: 2
                            })
                        }),
                        pageCapacity: 25,
                        query: null
                    })
                },                
                restoredObj = null;
            inst1.detail.key = inst1;
            inst2.detail.key = inst2;
            restoredObj = serialiser.deserialise(serialiser.serialise(objToSerialise));
            assert.deepEqual(restoredObj, objToSerialise, "object after serialisation-deserialisation process is not equal to ");
            done();
        });
    </script>

</body>

</html>
