<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/core-media-query/core-media-query.html">
<link rel="import" href="/resources/polymer/core-tooltip/core-tooltip.html">
<link rel="import" href="/tg-web-app/tg-app-config.html">
<link rel="import" href="/tg-reflector">

<polymer-element name="tg-entity-grid-inspector" attributes="entityType entities" layout vertical>
    <template>
        <style>
            .table-container {
                overflow-y: auto;
                overflow-x: hidden;
            }
            :host::shadow * /deep/ core-tooltip::shadow #tooltip {
                white-space: normal;
            }
            :host::shadow * /deep/ core-tooltip .span-tooltip {
                line-height: 15px;
            }
            :host::shadow core-tooltip.delayed:hover::shadow .core-tooltip,
            :host::shadow core-tooltip.delayed:focus::shadow .core-tooltip {
                opacity: 1;
                -webkit-transition-delay: 1s;
                transition-delay: 1s;
                transform: translate3d(0px, 0px, 0px);
            }
        </style>
        <content id="column_selector" select="tg-property-column" hidden></content>
        <tg-app-config id="appConfig"></tg-app-config>
        <tg-reflector id="reflector"></tg-reflector>
        <core-media-query query="max-width: {{$.appConfig.minTabletWidth - 1}}px" querymatches="{{mobileScreen}}"></core-media-query>
        <core-media-query query="(min-width: {{$.appConfig.minTabletWidth}}px) and (max-width: {{$.appConfig.minDesktopWidth - 1}}px)" querymatches="{{tabletScreen}}"></core-media-query>
        <core-media-query query="min-width: {{$.appConfig.minDesktopWidth}}px" querymatches="{{desktopScreen}}"></core-media-query>
        <!--<table>
            <tr>
                <template repeat="{{column in columns}}">
                    <td style="width: {{column.width}}">{{getTitle(column)}}</td>
                </template>
            </tr>
        </table>-->
        <!--<div class="table-container">-->
        <table>
            <thead>
                <tr>
                    <template repeat="{{column in columns}}">
                        <th>
                            <core-tooltip position="bottom" class="delayed" style="width:100%">
                                {{column.columnTitle}}
                                <span class="span-tooltip" tip>{{column.columnDesc}}</span>
                            </core-tooltip>
                        </th>
                    </template>
                </tr>
            </thead>
            <tbody>
                <template repeat="{{entity in entities}}">
                    <tr>
                        <template repeat="{{column in columns}}">
                            <td>
                                <core-tooltip position="bottom" class="delayed" style="width:100%">
                                    <a href="{{column.url}}">{{getValue(entity, column)}}</a>
                                    <span class="span-tooltip" tip>{{getTooltip(entity, column)}}</span>
                                </core-tooltip>
                            </td>
                        </template>
                    </tr>
                </template>
            </tbody>
        </table>
        <!--</table>
</div>-->
        <!--<table>
            <tr>
                <template repeat="{{column in columns}}">
                    <td style="width: {{column.width}}">total</td>
                </template>
            </tr>
        </table>-->
    </template>
    <script>
        (function () {
            Polymer({
                ready: function () {
                    this.columns = [];
                    Array.prototype.forEach.call(this.$.column_selector.getDistributedNodes(), function (item) {
                        this.columns.push(item);
                    }.bind(this));
                },
                getTooltip: function (entity, column) {
                    if (this.$.reflector.findTypeByName(column.type)) {
                        return entity.get(column.property ? "desc" : (column.property + ".desc"));
                    } else {
                        return entity.get(column.property);
                    }
                },
                getValue: function (entity, column) {
                    if (this.$.reflector.findTypeByName(column.type)) {
                        return entity.get(column.property ? "key" : (column.property + ".key"));
                    } else {
                        return entity.get(column.property);
                    }
                }
            });
        })();
    </script>
</polymer-element>