<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/resources/layout/tg-flex-layout.html">
<link rel="import" href="/resources/centre/criterion/tg-range-criterion.html">

<polymer-element name="tg-date-range-criterion" extends="tg-range-criterion" attributes="datePrefix dateMnemonic andBefore">
    <template>
        <shadow>
        </shadow>	        
    </template>
    <script>
        Polymer('tg-date-range-criterion', {
            publish: {
                /**
                 * This published property specifies the 'date prefix' for this date criterion.
                 */
                datePrefix: null, // values 'PREV', 'CURR', 'NEXT'. (see DateRangePrefixEnum.java)

                /**
                 * This published property specifies the 'date mnemonic' for this date criterion.
                 */
                dateMnemonic: null, // values 'DAY', 'MONTH', 'WEEK', 'YEAR' etc. (see MnemonicEnum.java)

                /**
                 * This published property specifies the 'and before' for this date criterion.
                 */
                andBefore: null // values 'null', 'true', 'false'
            },

            _dateRange: true,
            _datePrefix: null,
            _dateMnemonic: null,
            _andBefore: null,

            created: function() {
                this.datePrefixes = ["PREV", "CURR", "NEXT"];
                this.dateMnemonics = ["DAY", "WEEK", "MONTH", "QRT1", "QRT2", "QRT3", "QRT4", "YEAR", "OZ_FIN_YEAR"];
                this.andBefores = ["THIS", "BEFORE", "AFTER"];
                this.prefixTitles = ["Previous", "Current", "Next"];
                this.mnemonicTitles = ["Day", "Week", "Month", "1-st quarter", "2-nd quarter", "3-rd quarter", "4-th quarter", "Year", "Financial year"];
                this.andBeforeTitles = ["", " and before", " and after"];
            },
            dateMetaValueChanged: function(e, detail, source) {
                if (source.checked) {
                    this._datePrefix = source.getAttribute("prefix");
                    this._dateMnemonic = source.getAttribute("mnemonic");
                    switch(source.getAttribute("andbefore")) {
                        case "THIS": this._andBefore = null; break;
                        case "BEFORE": this._andBefore = true; break;
                        case "AFTER": this._andBefore = false; break;
                    }
                } else {
                    this._datePrefix = null;
                    this._dateMnemonic = null;
                    this._andBefore = null;
                }
            },
            acceptMetaValues: function() {
                this.datePrefix = this._datePrefix;
                this.dateMnemonic = this._dateMnemonic;
                this.andBefore = this._andBefore;

                this.super();
            },

            cancelMetaValues: function() {
                this._datePrefix = this.datePrefix;
                this._dateMnemonic = this.dateMnemonic;
                this._andBefore = this.andBefore;

                this.super();
            },

            datePrefixChanged: function(oldValue, newValue) {
                this._datePrefix = newValue;   
            }, 

            dateMnemonicChanged: function(oldValue, newValue) {
                this._dateMnemonic = newValue;   
            },

            andBeforeChanged: function(oldValue, newValue) {
                this._andBefore = newValue;   
            },
            
            /**
             * Returns 'true' if criterion has no meta values assigned, 'false' otherwise.
             */
            hasNoMetaValues: function(orNull, not, exclusive, exclusive2, datePrefix, dateMnemonic, andBefore) {
            	return this.super([orNull, not, exclusive, exclusive2, datePrefix, dateMnemonic, andBefore]) && datePrefix === null && dateMnemonic === null && andBefore === null;
            }
        });
    </script>
</polymer-element>