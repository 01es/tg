<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/tg-reflector">
<link rel="import" href="/resources/layout/tg-flex-layout.html">
<link rel="import" href="/resources/polymer/core-icon-button/core-icon-button.html">
<link rel="import" href="/resources/polymer/paper-dialog/paper-action-dialog.html">
<link rel="import" href="/resources/polymer/paper-checkbox/paper-checkbox.html">
<link rel="stylesheet" href="/resources/centre/criterion/tg-criterion.css">

<polymer-element name="tg-criterion" attributes="orNull not" layout horizontal end>
    <template>
        <tg-reflector id="reflector"></tg-reflector>
        <content select=":not(text)" id="components">
        </content>
        <core-icon-button on-click="{{showMetaValuesEditor}}" icon="more-vert"></core-icon-buton>
        <paper-action-dialog class="meta-value-editor" id="metaValueEditor" backdrop autoCloseDisabled>
            <div layout vertical>
                <paper-checkbox label="Missing value" checked="{{_orNull}}"></paper-checkbox>
                <paper-checkbox label="Not" checked="{{_not}}"></paper-checkbox>
            </div>
            <paper-button affirmative on-tap="{{cancelMetaValues}}">Cancel</paper-button>
            <paper-button affirmative autofocus on-tap="{{acceptMetaValues}}">Ok</paper-button>
        </paper-action-dialog>
    </template>
    <script>
        Polymer('tg-criterion', {
            publish: {
                /**
                 * This published property specifies whether 'missing value' will be also considered in search queries.
                 */
                orNull: false,

                /**
                 * This published property specifies whether the criterion should be negated.
                 */
                not: false
            },

            _orNull: false,
            _not: false,

            ready: function() {
                var flexElement = document.createElement('tg-flex-layout');
                flexElement.whenDesktop = this.whenDesktop;
                flexElement.whenTablet = this.whenDesktop;
                flexElement.whenMobile = this.whenDesktop;

                Array.prototype.forEach.call(this.$.components.getDistributedNodes(), function (item) {
                    flexElement.appendChild(item);
                }.bind(this));
                this.appendChild(flexElement);
            },

            whenDesktop: ['horizontal', 'justified', 'flex', ['flex']],
            whenTablet: this.whenDesktop,
            whenMobile: this.whenDesktop,

            showMetaValuesEditor: function (e) {
                this.$.metaValueEditor.open();
            },
            acceptMetaValues: function() {
                this.orNull = this._orNull;
                this.not = this._not;
            },
            cancelMetaValues: function() {
                this._orNull = this.orNull;
                this._not = this.not;
            },
            orNullChanged: function(oldValue, newValue) {
                this._orNull = newValue;
            },
            notChanged: function(oldValue, newValue) {
                this._not = newValue;   
            }
        });
    </script>
</polymer-element>