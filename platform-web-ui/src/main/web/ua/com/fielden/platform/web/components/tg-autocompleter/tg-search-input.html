<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/resources/polymer/paper-button/paper-button.html">
<link rel="import" href="/resources/polymer/iron-input/iron-input.html">
<link rel="import" href="/resources/polymer/paper-input/paper-input-container.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/polymer/iron-icons/iron-icons.html">
<link rel="import" href="/resources/polymer/iron-icon/iron-icon.html">
<link rel="import" href="/resources/polymer/paper-spinner/paper-spinner.html">
<link rel="import" href="/resources/components/tg-autocompleter/tg-search-result.html">

<dom-module id="tg-search-input">

    <style>
        .input-layout {
            @apply(--layout-horizontal);
            @apply(--layout-center);
        }
        
        .search-button {
            align-self: flex-end;
            --iron-icon-height: 16px;
            --iron-icon-width: 16px;
            padding-left: 4px;
            padding-right: 2px;
            padding-top: 2px;
            padding-bottom: 2px;
            height: 20px;
            width: 20px;
            margin: 0px;
        }
        
        paper-spinner {
            width: 17px;
            height: 16px;
            padding-right: 2px;
            margin: 0px;
            --paper-spinner-layer-1-color: var(--paper-blue-500);
            --paper-spinner-layer-2-color: var(--paper-blue-500);
            --paper-spinner-layer-3-color: var(--paper-blue-500);
            --paper-spinner-layer-4-color: var(--paper-blue-500);
        }
    </style>

    <template>
        <div id="container">
            <paper-input-container id="decorator">
                <label>search</label>
                <div class="input-layout">
                    <input id="input" is="iron-input" type="text" />
                    <paper-icon-button hidden$="{{searching}}" on-tap="_search" icon="search" class="search-button" tabIndex="-1"></paper-icon-button>
                    <paper-spinner active hidden$="{{!searching}}" tabIndex="-1" alt="searching..."></paper-spinner>
                </div>
            </paper-input-container>
            <tg-search-result id="result"></tg-search-result>
        </div>
    </template>

</dom-module>

<script>
    (function () {
        Polymer({
            is: 'tg-search-input',
            properties: {
                searching: {
                    type: Boolean,
                    value: false,
                    notify: false
                }
            },
            _search: function () {
                var self = this;
                self.async((function () {
                    self.$.result.close();
                    self.searching = true;
                    self.$.input.focus();
                }).bind(self), 3);

                this.async((function () {
                    self.searching = false;
                    var result = self.$.result;
                    var container = self.$.container;
                    var decorator = self.$.decorator;

                    result.values = [{
                        key: 'KEY 1',
                        desc: "some description for key 1"
                    }, {
                        key: 'KEY 2',
                        desc: "some description for key 2"
                    }];
                    self.async(function () {
                        result.style.position = 'absolute';
                        result.style.top = (container.offsetTop + decorator.offsetHeight) + 'px';
                        result.style.width = container.offsetWidth + 'px';
                        result.open();
                    });

                }).bind(self), 1000);
            }
        });
    })();
</script>