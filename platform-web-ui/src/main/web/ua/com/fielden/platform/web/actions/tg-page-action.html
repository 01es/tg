<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/tg-reflector">
<link rel="import" href="/resources/serialisation/tg-serialiser.html">
<link rel="import" href="/resources/polymer/core-icon-button/core-icon-button.html">
<link rel="import" href="/resources/polymer/paper-dialog/paper-action-dialog.html">
<link rel="import" href="/resources/element_loader/load-element.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">
<link rel="import" href="/resources/components/postal-lib.html">

<polymer-element name="tg-page-action" attributes="context icon action"> <!-- enabledStates currentState  -->
    <template>
        <core-icon-button id="actionButton" icon="{{icon}}" on-tap="{{run}}"></core-icon-button> <!-- disabled?="{{!isEnabled(enabledStates, currentState, enabled)}}" -->
    </template>
    <script>
        Polymer({
            publish: {

            	// /**
                //  * A list of the states in which the action can be enabled.
                //  */
                // enabledStates: null,

                // /**
                //  * The state of the parent view.
                //  */
                // currentState: null,

                /**
                 * The icon specificator (string id).
                 */
                icon: null
            },

            /**
             * This inner state is triggered by the action itself after the action button has been pressed (enabled:=false) and after the action
             * has been executed (enabled:=true).
             */
            // enabled: true,

            /**
             * Initialisation block.
             */
            ready: function () {
                var self = this;

                self.run = self.run.bind(self);
            },

            // /**
            //  * Returns whether the action is enabled in current moment.
            //  */
            // isEnabled: function (enabledStates, currentState, enabled) {
            //     if (enabledStates) {
            //         // console.log("isEnabled successful: enabledStates == ", enabledStates, "currentState == ", currentState, "enabled == ", enabled);
            //         return enabledStates.indexOf(currentState) >= 0 && enabled;
            //     } else {
            //         console.warn("isEnabled: enabledStates is not ready at this stage! enabledStates == ", enabledStates);
            //         return false;
            //     }
            // },

            /**
             * Executes the action.
             *
             * Please override this method in descendands to implement specific execution logic.
             */
            run: function (e, detail, source) {
                // this.enabled = false;
                console.log(this.shortDesc + ": execute");

                // TODO var context = ...;
                // var ser = this.$.serialiser.serialise(context);
                // this.$.actionExecutor.body = JSON.stringify(ser);
                this.action(this.context);
            }
        });
    </script>
</polymer-element>