<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/paper-tabs/paper-tabs.html">
<link rel="import" href="/resources/polymer/paper-tabs/paper-tab.html">
<link rel="import" href="/resources/polymer/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="/tg-reflector">
<link rel="import" href="/resources/centre/tg-selection-criteria.html">
<link rel="import" href="/resources/egi/tg-entity-grid-inspector.html">
<link rel="import" href="/resources/egi/tg-property-column.html">
<link rel="import" href="/resources/egi/tg-primary-instance-action.html">
<link rel="import" href="/resources/egi/tg-secondary-instance-action.html">
<link rel="import" href="/resources/polymer/core-icon-button/core-icon-button.html">
<link rel="import" href="/resources/polymer/core-tooltip/core-tooltip.html">
<link rel="import" href="/resources/polymer/core-icons/core-icons.html">
<link rel="import" href="/resources/polymer/core-icons/editor-icons.html">
<link rel="import" href="/resources/polymer/core-icons/hardware-icons.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">

<polymer-element name="tg-entity-centre">
    <template>
        <tg-serialiser id="serialiser"></tg-serialiser>
        <style>
            * /deep/ core-tooltip::shadow #tooltip {
                white-space: normal;
            }
            
            * /deep/ core-tooltip .span-tooltip {
                line-height: 15px;
            }
            
            core-icon-button.revers::shadow core-icon {
                transform: scale(-1, 1);
            }
            
            core-tooltip.delayed:hover::shadow .core-tooltip,
            core-tooltip.delayed:focus::shadow .core-tooltip {
                opacity: 1;
                -webkit-transition-delay: 1s;
                transition-delay: 1s;
                transform: translate3d(0px, 0px, 0px);
            }
            
            .tabs {
                background-color: #0288D1;
                color: #fff;
            }
        </style>
        <div class="tabs" layout horizontal center-justified>
            <paper-tabs selected="{{selectedView}}" style="max-width:600px" flex>
                <paper-tab>Selection</paper-tab>
                <paper-tab>Details</paper-tab>
            </paper-tabs>
        </div>
        <core-animated-pages selected="{{selectedView}}" transitions="slide-from-right">
            <div>
                <div layout vertical style="margin: 40px;">
                    <tg-selection-criteria id="selection_criteria" user="SU" mitype="ua.com.fielden.platform.sample.domain.MiTgPersistentEntityWithProperties" onRun="{{onRun}}"></tg-selection-criteria>
                    <div layout horizontal justified style="margin-top:40px;">
                        <div layout horizontal>
                            <paper-button id="configurator" raised roll="button" on-tap="{{configure}}" style="margin-left: 0px;">Configure</paper-button>
                            <paper-button id="saver" raised roll="button" on-tap="{{save}}">Save</paper-button>
                        </div>
                        <paper-button id="runner" raised roll="button" on-tap="{{run}}" style="margin-right: 0px;">Run</paper-button>
                    </div>
                </div>
            </div>
            <div>
                <div layout vertical center>
                    <tg-entity-grid-inspector id="egi" entityType="ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties">
                        <tg-property-column property="" width="400px" type="ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties" columnTitle="Key" columnDesc="Key tooltip"></tg-property-column>
                        <tg-property-column property="desc" width="400px" type="String" columnTitle="Description" columnDesc="Description tooltip"></tg-property-column>
                        <tg-property-column property="integerProp" width="150px" type="Integer" columnTitle="Integer property" columnDesc="Integer property tooltip"></tg-property-column>
                        <tg-property-column property="bigDecimalProp" width="150px" type="BigDecimal" columnTitle="Big decimal property" columnDesc="Big decimal property tooltip"></tg-property-column>
                        <tg-property-column property="entityProp" width="400px" type="ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties" columnTitle="Entity prop" columnDesc="Entity prop tooltip"></tg-property-column>
                        <tg-property-column property="booleanProp" width="400px" type="Boolean" columnTitle="Boolean prop" columnDesc="Boolean prop tooltip"></tg-property-column>
                        <tg-property-column property="dateProp" width="400px" type="Date" columnTitle="Date prop" columnDesc="Date prop tooltip"></tg-property-column>
                        <tg-property-column property="compositeProp" width="400px" type="ua.com.fielden.platform.sample.domain.TgPersistentCompositeEntity" columnTitle="Composite prop" columnDesc="Composite prop tooltip"></tg-property-column>
                        <tg-property-column property="stringProp" width="200px" type="String" columnTitle="String property" columnDesc="String property tooltip"></tg-property-column>

                        <core-tooltip class="delayed entity-specific-action">
                            <core-icon-button icon="add-circle-outline"></core-icon-button>
                            <span class="span-tooltip" tip>Create new entity</span>
                        </core-tooltip>
                        <core-tooltip class="delayed entity-specific-action">
                            <core-icon-button icon="editor:mode-edit"></core-icon-button>
                            <span class="span-tooltip" tip>Edit selected entity</span>
                        </core-tooltip>
                        <core-tooltip class="delayed entity-specific-action">
                            <core-icon-button icon="remove-circle-outline"></core-icon-button>
                            <span class="span-tooltip" tip>Delete selected entity</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button icon="file-download"></core-icon-button>
                            <span class="span-tooltip" tip>Export to Excel</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button class="revers" icon="hardware:keyboard-tab" on-tap="{{firstPage}}" disabled?="{{canNotFirst($.selection_criteria.pageNumber)}}"></core-icon-button>
                            <span class="span-tooltip" tip>First page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button icon="hardware:keyboard-backspace" on-tap="{{prevPage}}" disabled?="{{canNotPrev($.selection_criteria.pageNumber)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Previous page</span>
                        </core-tooltip>
                        <span class="standart-action">page {{$.selection_criteria.pageNumber !== null ? ($.selection_criteria.pageNumber + 1) : 0}} of {{$.selection_criteria.pageCount !== null ? $.selection_criteria.pageCount : 0}}</span>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button class="revers" icon="hardware:keyboard-backspace" on-tap="{{nextPage}}" disabled?="{{canNotNext($.selection_criteria.pageNumber, $.selection_criteria.pageCount)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Next page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button icon="hardware:keyboard-tab" on-tap="{{lastPage}}" disabled?="{{canNotLast($.selection_criteria.pageNumber, $.selection_criteria.pageCount)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Last page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action">
                            <core-icon-button icon="refresh" on-tap="{{run}}"></core-icon-button>
                            <span class="span-tooltip" tip>Refresh</span>
                        </core-tooltip>
                        <tg-primary-instance-action actionDesc="action description" icon="editor:mode-edit"></tg-primary-instance-action>
                        <tg-secondary-instance-action actionDesc="action description"></tg-secondary-instance-action>
                        <!--<tg-secondary-instance-action actionDesc="action description 2"></tg-secondary-instance-action>-->
                    </tg-entity-grid-inspector>
                </div>
            </div>
        </core-animated-pages>
    </template>
    <script>
        (function () {
            Polymer({
                selectedView: 0,

                /**
                 * Initialisation block. It has all children web components already initialised.
                 */
                ready: function () {
                    var self = this;
                    self.super();

                    self.onRun = self.onRun.bind(self);
                },

                /**
                 * Starts the process of criteria entity retrieval.
                 */
                retrieve: function () {
                    this.$.selection_criteria.retrieve();
                },

                /**
                 * Starts the process of centre run.
                 */
                run: function () {
                    this.$.egi.clearSelection();
                    this.$.selection_criteria.run();
                    this.selectedView = 1;
                },

                /**
                 * Starts the process of retrieving first page (only after run() has been already performed).
                 */
                firstPage: function () {
                    this.$.selection_criteria.firstPage();
                },

                /**
                 * Starts the process of retrieving last page (only after run() has been already performed).
                 */
                lastPage: function () {
                    this.$.selection_criteria.lastPage();
                },

                /**
                 * Starts the process of retrieving next page (only after run() has been already performed).
                 */
                nextPage: function () {
                    this.$.selection_criteria.nextPage();
                },

                /**
                 * Starts the process of retrieving prev page (only after run() has been already performed).
                 */
                prevPage: function () {
                    this.$.selection_criteria.prevPage();
                },

                canNotPrev: function (pageNumber) {
                    return typeof this.$ === 'undefined' ? true : !this.$.selection_criteria.canPrev(pageNumber);
                },
                canNotNext: function (pageNumber, pageCount) {
                    return typeof this.$ === 'undefined' ? true : !this.$.selection_criteria.canNext(pageNumber, pageCount);
                },
                canNotFirst: function (pageNumber) {
                    return typeof this.$ === 'undefined' ? true : !this.$.selection_criteria.canFirst(pageNumber);
                },
                canNotLast: function (pageNumber, pageCount) {
                    return typeof this.$ === 'undefined' ? true : !this.$.selection_criteria.canLast(pageNumber, pageCount);
                },

                onRun: function (criteriaEntity, newBindingEntity, resultEntities, pageCount) {
                    console.log("onRun", criteriaEntity, newBindingEntity, resultEntities, pageCount);
                    this.$.egi.entities = resultEntities;
                }
            });
        })();
    </script>
</polymer-element>