<!--@imports-->
<link rel="import" href="/resources/polymer/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/slide-from-right.html">

<link rel="import" href="/resources/centre/tg-selection-criteria.html">
<link rel="import" href="/resources/centre/tg-entity-centre.html">

<link rel="import" href="/resources/polymer/paper-button/paper-button.html">

<!-- EGI imports -->
<link rel="import" href="/resources/egi/tg-entity-grid-inspector.html">

<link rel="import" href="/resources/actions/tg-page-action.html">

<link rel="import" href="/resources/polymer/core-icon-button/core-icon-button.html">
<link rel="import" href="/resources/polymer/core-tooltip/core-tooltip.html">
<link rel="import" href="/resources/polymer/core-icons/core-icons.html">
<link rel="import" href="/resources/polymer/core-icons/editor-icons.html">
<link rel="import" href="/resources/polymer/core-icons/hardware-icons.html">

<polymer-element name="tg-@entity_type-selection-criteria" extends="tg-selection-criteria">
    <template>
        <shadow></shadow>
        <!--CRITERIA EDITORS DOM (GENERATED) -->
        <!--@criteria_editors-->
    </template>
    <script>
        (function () {
            Polymer({});
        })();
    </script>
</polymer-element>

<polymer-element name="tg-@entity_type-centre" extends="tg-entity-centre" entityType="@full_entity_type" mitype="@mi_type" getMasterEntity="{{null}}">
    <!-- layout vertical -->
    <template>
        <shadow></shadow>
        <style>
            * /deep/ core-tooltip::shadow #tooltip {
                white-space: normal;
            }
            * /deep/ core-tooltip .span-tooltip {
                line-height: 15px;
            }
            core-icon-button.revers::shadow core-icon {
                transform: scale(-1, 1);
            }
            core-tooltip.delayed:hover::shadow .core-tooltip,
            core-tooltip.delayed:focus::shadow .core-tooltip {
                opacity: 1;
                -webkit-transition-delay: 1s;
                transition-delay: 1s;
                transform: translate3d(0px, 0px, 0px);
            }
            .selection-criteria,
            .entity-grid-inspector {
                background-color: white;
            }
            .group {
                margin-left: 30px;
            }
            core-animated-pages {
                overflow: auto;
                position: absolute;
                top: 48px;
                left: 0px;
                right: 0px;
                bottom: 0px;
            }
        </style>
        <core-animated-pages selected="{{selectedView}}" transitions="slide-from-right">
            <div>
                <div class="selection-criteria" layout vertical style="padding: 40px;">
                    <tg-@entity_type-selection-criteria id="selection_criteria" uuid="{{uuid}}" user="{{user}}" mitype="@mi_type" onRun="{{onRun}}" getSelectedEntities="{{getSelectedEntities}}" onRetrieved="{{onRetrieved}}"></tg-@entity_type-selection-criteria>
                    <div layout horizontal justified style="margin-top:40px;">
                        <div layout horizontal>
                            <paper-button id="configurator" raised roll="button" on-tap="{{configure}}" style="margin-left: 0px;">Configure</paper-button>
                            <paper-button id="saver" raised roll="button" on-tap="{{save}}" disabled?="{{!canSave($.selection_criteria._isCentreChanged)}}">Save</paper-button>
                            <paper-button id="discarder" raised roll="button" on-tap="{{discard}}" disabled?="{{!canDiscard($.selection_criteria._isCentreChanged)}}">Discard</paper-button>
                        </div>
                        <paper-button id="runner" raised roll="button" on-tap="{{run}}" style="margin-right: 0px;">Run</paper-button>
                    </div>
                </div>
            </div>
            <div>
                <div layout vertical center>
                    <tg-entity-grid-inspector class="entity-grid-inspector" id="egi" entityType="@full_entity_type">
                        <!--EGI COLUMNS DOM (GENERATED) -->
                        <!--@egi_columns-->

                        <core-tooltip class="delayed entity-specific-action" tabIndex="-1">
                            <!--<core-icon-button icon="add-circle-outline"></core-icon-button>-->
                            <tg-page-action icon="add-circle-outline" action="{{newAction}}"></tg-page-action>
                            <span class="span-tooltip" tip>Create new entity</span>
                        </core-tooltip>
                        <core-tooltip class="delayed entity-specific-action" tabIndex="-1">
                            <tg-page-action icon="editor:mode-edit" action="{{editAction}}"></tg-page-action>
                            <span class="span-tooltip" tip>Edit selected entity</span>
                        </core-tooltip>
                        <core-tooltip class="delayed entity-specific-action" tabIndex="-1">
                            <core-icon-button icon="remove-circle-outline"></core-icon-button>
                            <span class="span-tooltip" tip>Delete selected entity</span>
                        </core-tooltip>
                        <!-- GENERATED FUNCTIONAL ACTIONS: -->
                        <!--@functional_actions-->
                        <!-- core-tooltip class="delayed entity-specific-action" tabIndex="-1">
	                        <tg-ui-action user="{{user}}" shortDesc="Function" longDesc="Functional context-dependent action" icon="editor:mode-edit" componentUri="/users/{{user}}/master/ua.com.fielden.platform.sample.domain.TgFunctionalEntityWithCentreContext" elementName="tg-TgFunctionalEntityWithCentreContext-master" attrs="{{ {user:user, entitytype:'ua.com.fielden.platform.sample.domain.TgFunctionalEntityWithCentreContext', currentState:'EDIT'} }}" contextRetriever="{{createCentreContextHolder}}" requireSelectedEntities="ALL" requireMasterEntity="false">
    	                    </tg-ui-action>
    	                    <span class="span-tooltip" tip>Functional context-dependent action</span>
                        </core-tooltip -->

                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button icon="file-download"></core-icon-button>
                            <span class="span-tooltip" tip>Export to Excel</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button class="revers" icon="hardware:keyboard-tab" on-tap="{{firstPage}}" disabled?="{{canNotFirst($.selection_criteria.pageNumber, $.selection_criteria.pageCount)}}"></core-icon-button>
                            <span class="span-tooltip" tip>First page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button icon="hardware:keyboard-backspace" on-tap="{{prevPage}}" disabled?="{{canNotPrev($.selection_criteria.pageNumber)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Previous page</span>
                        </core-tooltip>
                        <span class="standart-action">page {{$.selection_criteria.pageNumber !== null ? ($.selection_criteria.pageNumber + 1) : 0}} of {{$.selection_criteria.pageCount !== null ? $.selection_criteria.pageCount : 0}}</span>
                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button class="revers" icon="hardware:keyboard-backspace" on-tap="{{nextPage}}" disabled?="{{canNotNext($.selection_criteria.pageNumber, $.selection_criteria.pageCount)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Next page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button icon="hardware:keyboard-tab" on-tap="{{lastPage}}" disabled?="{{canNotLast($.selection_criteria.pageNumber, $.selection_criteria.pageCount)}}"></core-icon-button>
                            <span class="span-tooltip" tip>Last page</span>
                        </core-tooltip>
                        <core-tooltip class="delayed standart-action" tabIndex="-1">
                            <core-icon-button icon="refresh" on-tap="{{run}}"></core-icon-button>
                            <span class="span-tooltip" tip>Refresh</span>
                        </core-tooltip>
                        <!--@primary_action-->
                        <!-- tg-primary-instance-action action="{{editSpecificEntity}}" actionDesc="action description" icon="editor:mode-edit"></tg-primary-instance-action>  -->
                        <!--@secondary_actions-->
                    </tg-entity-grid-inspector>
                </div>
            </div>
        </core-animated-pages>
    </template>
    <script>
        (function () {
            Polymer({
                /**
                 * Initialisation block. It has all children web components already initialised.
                 */
                ready: function () {
                    this.super();
                    var self = this;

                    // TODO smth. like this should be generated here:
                    self.topLevelActions = [
                        //generatedActionObjects                                            
                    ];
                    self.secondaryActions = [
                        //generatedSecondaryActions                                            
                    ];
                    self.primaryAction = [
                        //generatedPrimaryAction                                            
                    ];
                    self.propActions = [
                        //generatedPropActions                                           
                    ];
                },

                onRetrieved: function (entity, newBindingEntity, customObject) {
                    console.log("centre onRetrieved");
                }
            });
        })();
    </script>
</polymer-element>