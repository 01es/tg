<link rel="import" href="/resources/polymer/polymer/polymer.html">

<polymer-element name="tg-reflector" hidden>
    <script>
        (function() {
            ////////////////////////////////////////// THE PROTOTYPE FOR EntityType ////////////////////////////////////////// 
            var EntityType = function(rawObject) { 
                Object.call(this);
                // copy all properties from rawObject after deserialisation
                for (var prop in rawObject) { 
                    this[prop] = rawObject[prop];
                }
            };
            EntityType.prototype = Object.create(Object.prototype);
            EntityType.prototype.constructor = EntityType;

            /**
             * Returns the number for the entity type inside the type table.
             * 
            */
            EntityType.prototype.number = function() {
                return this._number;
            }

            /**
             * Returns full Java class name for the entity type.
             * 
            */
            EntityType.prototype.fullClassName = function() {
                return this.key;
            }

            /**
             * Returns 'true' when the entity type represents composite entity, 'false' otherwise. 
             * 
             * Use compositeKeyNames() function to determine property names for the key members.
            */
            EntityType.prototype.isCompositeEntity = function() {
                return typeof this._compositeKeyNames !== 'undefined' && this._compositeKeyNames && this._compositeKeyNames.length > 0;
            }

            /** 
             * Returns the property names for the key members in case of composite entity, 'undefined' otherwise.
            */
            EntityType.prototype.compositeKeyNames = function() {
                return this._compositeKeyNames;
            }

            /** 
             * Returns the key member separator in case of composite entity, 'undefined' otherwise.
            */
            EntityType.prototype.compositeKeySeparator = function() {
                return typeof this._compositeKeySeparator === 'undefined' ? " " : this._compositeKeySeparator;
            }

            /** 
             * Returns entity title.
            */
            EntityType.prototype.entityTitle = function() {
                return typeof this._entityTitle === 'undefined' ? this._entityTitleDefault() : this._entityTitle;
            }

            /** 
             * Returns entity description.
            */
            EntityType.prototype.entityDesc = function() {
                return typeof this._entityDesc === 'undefined' ? this._entityDescDefault() : this._entityDesc;
            }

            /** 
             * Returns entity title.
            */
            EntityType.prototype._entityTitleDefault = function() {
                var title = this._breakClassName(this.fullClassName());
                return title;
            }

            /** 
             * Returns entity title.
            */
            EntityType.prototype._entityDescDefault = function() {
                var title = this._breakClassName(this.fullClassName());
                return title + " entity";
            }

            /** 
             * Returns entity title.
            */
            EntityType.prototype._breakClassName = function(className) {
                // TODO implement when needed (TitlesDescsGetter.breakClassName method)
                return className;
            }
            ////////////////////////////////////////// THE PROTOTYPE FOR EntityInstanceProp ////////////////////////////////////////// 
            var EntityInstanceProp = function() {
                Object.call(this);
            };
            EntityInstanceProp.prototype = Object.create(Object.prototype);
            EntityInstanceProp.prototype.constructor = EntityInstanceProp;

            /**
             * Returns 'true' when the instance property is editable, false otherwise.
             * 
             * IMPORTANT: do not use '_editable' field directly!
            */
            EntityInstanceProp.prototype.isEditable = function() {
                return typeof this._editable === 'undefined' ? true : this._editable;
            }

            /**
             * Returns 'true' when the instance property is dirty, false otherwise.
             * 
             * IMPORTANT: do not use '_dirty' field directly!
            */
            EntityInstanceProp.prototype.isDirty = function() {
                return typeof this._dirty === 'undefined' ? false : this._dirty;
            }

            /**
             * Returns 'true' when the instance property is required, false otherwise.
             * 
             * IMPORTANT: do not use '_required' field directly!
            */
            EntityInstanceProp.prototype.isRequired = function() {
                return typeof this._required === 'undefined' ? false : this._required;
            }

            /**
             * Returns 'true' when the instance property is visible, false otherwise.
             * 
             * IMPORTANT: do not use '_visible' field directly!
            */
            EntityInstanceProp.prototype.isVisible = function() {
                return typeof this._visible === 'undefined' ? true : this._visible;
            }

            /**
             * Returns validation result (failure or warning) for the instance property or 'null' if successful without warnings.
             * 
             * IMPORTANT: do not use '_validationResult' field directly!
            */
            EntityInstanceProp.prototype.validationResult = function() {
                return typeof this._validationResult === 'undefined' ? null : this._validationResult;
            }

            ////////////////////////////////////////// THE PROTOTYPE FOR Entity ////////////////////////////////////////// 
            var Entity = function(rawObject) { // rawObject
                Object.call(this);

                if (rawObject) {
                    // copy all properties from rawObject if it is not empty
                    for (var prop in rawObject) { 
                        this[prop] = rawObject[prop];
                    }
                }
            };
            Entity.prototype = Object.create(Object.prototype);
            Entity.prototype.constructor = Entity;

            /**
             * Returns the type for the entity.
             * 
             * IMPORTANT: do not use '_type' field directly!
            */
            Entity.prototype.type = function() {
                return this._type;
            }

            ////////////////////////////////////////// THE PROTOTYPE FOR EntityInstanceProp ////////////////////////////////////////// 
            var providePrototypes = function(typeTable) {
                    for (var key in typeTable) {
                        if (typeTable.hasOwnProperty(key)) {
                            var entityType = typeTable[key];
                            typeTable[key] = new EntityType(entityType);
                            // entityType.prototype = EntityType.prototype;
                            // entityType.__proto__ = EntityType.prototype;
                        }
                    }
                    return typeTable;
                },
                typeTable = providePrototypes(@typeTable);

            console.log("typeTable = ", typeTable);
            // console.log("typeTable['34'].isCompositeEntity() = ", typeTable['34'].isCompositeEntity());

            Polymer({
                getType: function(number) {
                    return typeTable[number];
                },

                getEntityInstancePropType: function() {
                    return EntityInstanceProp;
                },

                getEntityType: function() {
                    return Entity;
                }
            });
        })();
    </script>
</polymer-element>