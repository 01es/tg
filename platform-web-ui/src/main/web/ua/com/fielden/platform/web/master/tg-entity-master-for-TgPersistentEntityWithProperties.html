<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/resources/editors/tg-singleline-text-editor.html">
<link rel="import" href="/resources/editors/tg-integer-editor.html">
<link rel="import" href="/resources/editors/tg-decimal-editor.html">
<link rel="import" href="/resources/layout/tg-flex-layout.html">
<link rel="import" href="/resources/master/tg-entity-master.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">
<link rel="import" href="/resources/master/actions/tg-entity-action.html">

<polymer-element name="tg-entity-master-for-TgPersistentEntityWithProperties" extends="tg-entity-master">
    <template>
        <shadow></shadow>
        <tg-flex-layout whenDesktop="{{whenDesktop}}" whenTablet="{{whenTablet}}" whenMobile="{{whenMobile}}">
            <!-- debug -->
            <!-- datetime-picker id="editor" label="Your Label" bindTo="{{currBindingEntity['dateProp']}}" ></datetime-picker -->
            <tg-integer-editor entity="{{currBindingEntity}}" propertyName="integerProp" onAcceptedValueChanged="{{validate}}" propTitle="{{_title(currEntity, 'integerProp')}}" propDesc="{{_desc(currEntity, 'integerProp')}}" msg="{{_msg(currEntity, 'integerProp')}}" msgType="{{_msgType(currEntity, 'integerProp')}}" currentState="{{currentState}}" action="{{actions['SNATCH_BACK_VEHICLE']}}"></tg-integer-editor>
            <tg-singleline-text-editor entity="{{currBindingEntity}}" propertyName="entityProp" onAcceptedValueChanged="{{validate}}" propTitle="{{_title(currEntity, 'entityProp')}}" propDesc="{{_desc(currEntity, 'entityProp')}}" msg="{{_msg(currEntity, 'entityProp')}}" msgType="{{_msgType(currEntity, 'entityProp')}}" currentState="{{currentState}}" action="{{actions['SNATCH_BACK_VEHICLE']}}"></tg-singleline-text-editor>
            <tg-decimal-editor entity="{{currBindingEntity}}" propertyName="bigDecimalProp" onAcceptedValueChanged="{{validate}}" propTitle="{{_title(currEntity, 'bigDecimalProp')}}" propDesc="{{_desc(currEntity, 'bigDecimalProp')}}" msg="{{_msg(currEntity, 'bigDecimalProp')}}" msgType="{{_msgType(currEntity, 'bigDecimalProp')}}" currentState="{{currentState}}" action="{{actions['SNATCH_BACK_VEHICLE']}}"></tg-decimal-editor>
            <tg-singleline-text-editor entity="{{currBindingEntity}}" propertyName="stringProp" onAcceptedValueChanged="{{validate}}" propTitle="{{_title(currEntity, 'stringProp')}}" propDesc="{{_desc(currEntity, 'stringProp')}}" msg="{{_msg(currEntity, 'stringProp')}}" msgType="{{_msgType(currEntity, 'stringProp')}}" currentState="{{currentState}}" action="{{actions['SNATCH_BACK_VEHICLE']}}"></tg-singleline-text-editor>

            <tg-entity-action user="{{actions['EXPORT'].user}}" entitytype="{{actions['EXPORT'].entitytype}}" preAction="{{actions['EXPORT'].preAction}}" postActionSuccess="{{actions['EXPORT'].postActionSuccess}}" postActionError="{{actions['EXPORT'].postActionError}}" enabledStates="{{actions['EXPORT'].enabledStates}}" shortDesc="{{actions['EXPORT'].shortDesc}}" longDesc="{{actions['EXPORT'].longDesc}}"></tg-entity-action>
            <paper-button id="refreshButton" raised roll="button" on-tap="{{retrieve}}">Refresh</paper-button> 
            <paper-button id="saveButton" raised roll="button" on-tap="{{save}}">Save</paper-button>
            <paper-button id="validateButton" raised roll="button" on-tap="{{validate}}">Validate</paper-button>
            <paper-button id="editButton" raised roll="button" on-tap="{{edit}}">Edit</paper-button>
            <paper-button id="viewButton" raised roll="button" on-tap="{{view}}">View</paper-button>
        </tg-flex-layout>
    </template>
    <script>
        (function () {
            Polymer('tg-entity-master-for-TgPersistentEntityWithProperties', {
                /**
                 * Initialisation block. It has all children web components already initialised.
                 */
                ready: function () {
                    this.super();
                    console.log("child ready");

                    var self = this;

                    // TODO smth. like this should be generated here:
                    this.actions['EXPORT'] = {
                        user: self.user,
                        entitytype: "ua.com.fielden.platform.sample.domain.TgExportFunctionalEntity",
                        shortDesc: 'Export ...',
                        longDesc: 'Export action for TgPersistentEntityWithProperties ...',
                        enabledStates: ['VIEW', 'EDIT'],
                        preAction: function() {
                            var functionalEntity = {id:null, version:0};// self.$.reflector.newEntity("ua.com.fielden.platform.sample.domain.TgExportFunctionalEntity");
                            // functionalEntity.parentEntity = null;
                            functionalEntity.parentEntity = { val: self.currEntity.get("key"), origVal: null };
                            // functionalEntity.set("parentEntity", { val: self.currEntity.get("key"), origVal: null });
                            return functionalEntity;
                        }, 
                        postActionSuccess: function(entity) {
                            console.log("postActionSuccess entity", entity);
                        }, 
                        postActionError: function(resultWithError) {
                            console.log("postActionError resultWithError", resultWithError);
                        }
                    };

                    this.actions['SNATCH_BACK_VEHICLE'] = {
                        user: self.user,
                        entitytype: "ua.com.fielden.platform.sample.domain.TgExportFunctionalEntity", // TODO make separate functional entity
                        longDesc: 'Snatch back sddsd ...',
                        icon: 'trending-up',
                        enabledStates: ['VIEW'],
                        preAction: function() {
                            var functionalEntity = {id:null, version:0};// self.$.reflector.newEntity("ua.com.fielden.platform.sample.domain.TgExportFunctionalEntity");
                            // functionalEntity.parentEntity = null;
                            functionalEntity.parentEntity = { val: self.currEntity.get("key"), origVal: null };
                            // functionalEntity.set("parentEntity", { val: self.currEntity.get("key"), origVal: null });
                            return functionalEntity;
                        }, 
                        postActionSuccess: function(entity) {
                            console.log("postActionSuccess entity", entity);
                        }, 
                        postActionError: function(resultWithError) {
                            console.log("postActionError resultWithError", resultWithError);
                        }
                    };                    
                },

                whenDesktop: ['vertical', 
                    ['horizontal', ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"]],
                    ['horizontal', ["margin-right: 40px"], ["margin-right: 40px"], ["margin-right: 40px"], ["margin-right: 40px"], ["margin-right: 40px"], ["margin-right: 40px"]] 
                ],

                whenTablet: ['horizontal', ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"]],
                whenMobile: ['horizontal', ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"], ["margin-right: 20px"]]
            });
        })();
    </script>
</polymer-element>