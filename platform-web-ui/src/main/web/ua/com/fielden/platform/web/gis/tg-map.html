<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/resources/gis/tg-gis-component.html">

<dom-module id="tg-map">
    <style>
        :host {
			display: inline-block;
			width: 100%;
		}
		
.map {
    width: 100%;
    height: 400px;
    border: 1px solid #ccc;
}
.progress {
    display: none;
    position: absolute;
    z-index: 1000;
    left: 400px;
    top: 300px;
    width: 200px;
    height: 20px;
    margin-top: -20px;
    margin-left: -100px;
    background-color: #fff;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 4px;
    padding: 2px;
}
.progress-bar {
    width: 0;
    height: 100%;
    background-color: #76A6FC;
    border-radius: 4px;
}
.map-container {
    height: 100%;
    width: 100%;
}

/* * Unlike other icons, you can style `L.divIcon` with CSS.
* These styles make each marker a circle with a border and centered text. */
.count-icon {
    background: #ff8888;
    border: 5px solid rgba(255, 255, 255, 0.5);
    color: #fff;
    font-weight: bold;
    text-align: center;
    border-radius: 50%;
    line-height: 30px;
}
.img-overlay img {
    margin: 0;
    opacity: 1.0;
    display: block;
}
.overlay {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    left: 0;
    width: 100%;
    /* height: 100%;
    */
    
    height: 24px;
    line-height: 24px;
    background-color: transparent;
    color: black;
    font-weight: bold;
    text-align: center;
    vertical-align: middle;
    /* margin-bottom: 0px;
    */
    font-size: 12px;
}
.img-overlay {
    position: relative;
    /* border: 1px #000 solid;
    */
    float: left;
}
.gps-marker-cluster {
    background-color: transparent;
}
		
		
    </style>
    <template>
        <div class="map-container">
            <div class="progress">
                <div class="progress-bar"></div>
            </div>
            <div class="map"></div>
        </div>
    </template>
</dom-module>

<script>
    (function () {
        Polymer({
            is: 'tg-map',
            
            ready: function() { 
                var self = this;
                
                console.debug('map div = ', this.querySelector('.map'));
                
             	// initialize the map on the "map" div with a given center and zoom
                /*var map = L.map(this.querySelector('.map'), {
                    center: [51.505, -0.09],
                    zoom: 13
                });
             	
        		var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        		var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    			var osmAttrib = '&copy; ' + osmLink + ' Contributors';
             	
        		var osmMap = L.tileLayer(osmUrl, {
        			maxZoom: 19,
        			minZoom: 0,
        			attribution: osmAttrib
        		});
        		
        		osmMap.addTo(map);*/
             	
                /* L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                    maxZoom: 18,
                    id: 'your.mapbox.project.id',
                    accessToken: 'your.mapbox.public.access.token'
                }).addTo(map); */
                
				/* require.config({
					paths: {
						// 'gis' feature-specific library modules:
						'leaflet': 'leaflet/leaflet', // AMD-compliant
						'css.leaflet': 'leaflet/leaflet',

						'googlemaps': 'leaflet/providers/googlemaps', // an 'async' requirejs plugin wrapper for google maps loading -- AMD-compliant
						'leaflet.googlemaps': 'leaflet/providers/Google', // non-AMD module
						'yandexmaps': "http://api-maps.yandex.ru/2.0/?load=package.map&lang=ru-RU", // non-AMD module // TODO: lang RU??		
						'leaflet.yandexmaps': 'leaflet/providers/Yandex', // non-AMD module

						'leaflet.draw': 'leaflet/draw/leaflet.draw', // non-AMD module
						'css.leaflet.draw': 'leaflet/draw/leaflet.draw', 

						'leaflet.markercluster': 'leaflet/markercluster/leaflet.markercluster', // non-AMD module
						'css.MarkerCluster.Default': 'leaflet/markercluster/MarkerCluster.Default',
						'css.MarkerCluster': 'leaflet/markercluster/MarkerCluster',

						'leaflet.loadingcontrol': 'leaflet/controlloading/Control.Loading',
						'css.Control.Loading': 'leaflet/controlloading/Control.Loading',						

						'leaflet.easybutton': 'leaflet/easybutton/easy-button', // non-AMD module
						'css.font-awesome': 'http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome', // 'leaflet/easybutton/font-awesome', // non-AMD module
						
						'leaflet.markerrotation': 'leaflet/markerrotation/Marker.Rotate' // non-AMD module
					},

					shim: {
						'leaflet': { // is AMD compliant, but we have provided shim config for it to enable dependency on appropriate css
							deps: ['css!css.leaflet'],
							exports: 'Leaflet1'
						},
						// MAP PROVIDERS:
						'leaflet.googlemaps': {
							deps: ['leaflet', 'googlemaps!'],
							exports: 'LeafletGoogleMaps'
						},
						'yandexmaps': {
							deps: [],
							exports: 'YandexMaps'
						},
						'leaflet.yandexmaps': {
							deps: ['leaflet', 'yandexmaps'],
							exports: 'LeafletYandexMaps'
						},

						// MAP DRAWING:
						'leaflet.draw': {
							deps: ['leaflet', 'css!css.leaflet.draw'],
							exports: 'LeafletDraw'
						},

						// MAP CLUSTERING:
						'leaflet.markercluster': {
							deps: ['leaflet', 'css!css.MarkerCluster.Default', 'css!css.MarkerCluster'],
							exports: 'LeafletMarkercluster'
						},

						'leaflet.loadingcontrol': { // is AMD compliant, but we have provided shim config for it to enable dependency on appropriate css
							deps: ['leaflet', 'css!css.Control.Loading'],
							exports: 'LeafletLoadingControl'
						},

						'leaflet.easybutton': {
							deps: ['leaflet', 'css!css.font-awesome'],
							exports: 'LeafletEasybutton'
						},

						'leaflet.markerrotation': {
							deps: ['leaflet'],
							exports: 'LeafletMarkerrotation'
						}
					},

					googlemaps: { // configuration for 'async' requirejs plugin wrapper (google maps loading)
						url: 'http://maps.google.com/maps/api/js',
						// url: 'https://maps.googleapis.com/maps/api/js',
						params: {
							'v': '3.2',
							// key: 'abcd1234',
							// libraries: 'geometry',
							sensor: false // Defaults to false
						}
						// async: asyncLoaderPlugin // Primarly for providing test stubs.
					}
				});

				require(['/resources/gis/GisComponent.js', 'css!main'], function(GisComponentClass, mainCss) {
					var _gisComponent = new GisComponentClass(iElement[0].lastElementChild, 
						iElement[0].firstElementChild, 
						iElement[0].firstElementChild.firstElementChild );
					if (typeof java !== 'undefined') {
						window.gisComponent = _gisComponent;
					}
					return _gisComponent;
				}); */
				
				var _gisComponent = new L.GIS.GisComponent(this.querySelector('.map'), this.querySelector('.progress'), this.querySelector('.progress-bar'));
				if (typeof java !== 'undefined') {
					window.gisComponent = _gisComponent;
				}
            }
        });
    })();
</script>