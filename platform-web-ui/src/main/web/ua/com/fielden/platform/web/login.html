<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>@title</title>
    <script src="/resources/polymer/webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="/resources/polymer/paper-input/paper-input-decorator.html">
    <link rel="import" href="/resources/polymer/core-input/core-input.html">
    <link rel="import" href="/resources/polymer/ajax-form/ajax-form.html">
    <link rel="import" href="/resources/polymer/font-roboto/roboto.html">
    <link rel="import" href="/resources/polymer/paper-button/paper-button.html">
    <link rel="import" href="/resources/polymer/paper-checkbox/paper-checkbox.html">

    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: "RobotoDraft";
            font-size: 10pt;
            background: #eee;
            -webkit-font-smoothing: antialiased;
        }
        
        h1,
        h3 {
            font-weight: 300;
        }
        
        h1 {
            color: #636363;
        }
        
        h3 {
            color: #4a89dc;
        }
        
        hgroup {
            text-align: center;
            margin-top: 4em;
        }
        
        form {
            width: 380px;
            margin: 2em auto;
            padding: 3em 2em 2em 2em;
            background: #fafafa;
            border: 1px solid #ebebeb;
            box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 1px 0px, rgba(0, 0, 0, 0.09804) 0px 1px 2px 0px;
        }
        
        .group {
            position: relative;
            margin-bottom: 45px;
        }
        
        paper-checkbox {
            margin: 1em 0px 0px 0px;
        }
        
        paper-checkbox::shadow #checkbox.checked {
            background-color: #4285f4;
            border-color: #4285f4;
        }
        
        .submit-normal {
            background: #4285f4;
            color: white;
        }
        
        .submit-error {
            background: #D32F2F;
            color: white;
        }
        
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>

</head>

<body unresolved fullbleed>

    <hgroup>
        <h1>Application Login</h1>
        <h3>Please provide valid credentials.</h3>
    </hgroup>

    <form is="ajax-form" action="login" method="put">
        <div class="group">
            <paper-input-decorator id="decorator" label="User Name" floatingLabel>
                <div layout horizontal>
                    <div flex>
                        <input id="in-username" is="core-input" type="text" name="username" required>
                    </div>
                </div>
            </paper-input-decorator>


            <paper-input-decorator id="decorator" label="Password" floatingLabel>
                <div layout horizontal>
                    <div flex>
                        <input id="in-passwd" is="core-input" type="password" name="passwd" required>
                    </div>
                </div>
            </paper-input-decorator>

            <paper-checkbox id="in-trusted-device-mock" label="Trusted device?"></paper-checkbox>
            <input id="in-trusted-device" type="hidden" name="trusted-device">
            <!--paper-input-decorator id="decorator" label="Pin Code" floatingLabel>
                <div layout horizontal>
                    <div flex>
                        <input id="in-pin-code" is="core-input" type="number" step="1" preventInvalidInput name="pin-code">
                    </div>
                </div>
            </paper-input-decorator-->
        </div>

        <paper-button id="submitButton" roll="button" style="width:100%" class="submit-normal">
            Login
        </paper-button>

        <!--input type="submit"-->
    </form>
    <script>
        (function () {
            var form = document.querySelectorAll('form')[0];
            form.reset();

            var submit = document.querySelector('#submitButton');
            var trustedDevice = document.querySelector('#in-trusted-device');
            var trustedDeviceMock = document.querySelector('#in-trusted-device-mock');

            submit.onclick = function () {
                // need to transfer value from a paper-checkbox that does not get submitted in the from
                // to a hidden input that does
                trustedDevice.value = trustedDeviceMock.checked;

                form.submit();
            }


            form.addEventListener('submitting', function () {
                submit.disabled = true;
            });

            form.addEventListener('submitted',
                function (event) {
                    console.log('Login response code: ', event.detail.status);
                    console.log('\tresponse: ', event.detail);

                    if (event.detail.status === 200) {
                        submit.classList.remove("submit-error");
                        submit.innerHTML = "Success";
                        window.location.href = event.detail.response;
                    } else {
                        submit.classList.add("submit-error");
                        submit.innerHTML = "Try Again"
                        submit.disabled = false;
                    }
                }
            );


        })();
    </script>
</body>

</html>