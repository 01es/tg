<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>@title</title>
    <script src="/resources/polymer/webcomponentsjs/webcomponents-lite.js"></script>
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="@title">
    <link rel="icon" sizes="192x192" href="/resources/icons/tg-icon192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="@title">
    <link rel="apple-touch-icon" href="/resources/icons/tg-icon.png">

    <!-- Tile icon for Win8 (144x144) -->
    <meta name="msapplication-TileImage" content="/resources/icons/tg-icon144x144.png">
    
    <link rel="import" href="/resources/polymer/polymer/polymer.html">
    <link rel="import" href="/resources/polymer/paper-styles/paper-styles.html">
    <link rel="import" href="/resources/polymer/iron-form/iron-form.html">
    <link rel="import" href="/resources/polymer/paper-input/paper-input-container.html">
    <link rel="import" href="/resources/polymer/iron-input/iron-input.html">
    <link rel="import" href="/resources/polymer/paper-button/paper-button.html">
    <link rel="import" href="/resources/polymer/paper-checkbox/paper-checkbox.html">

    <!-- 
       The se of is="custom-style" is an experimental feature. 
       More info at https://www.polymer-project.org/1.0/docs/devguide/styling.html#custom-style
    -->
    <style is="custom-style">
        * {
            box-sizing: border-box;
        }
        .vertical-section {
            @apply(--paper-font-body1);

line-height: 25px;
            margin-bottom: 25px;
        }
        body {
            font-family: 'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif';
            font-size: 10pt;
            background: #eee;
            -webkit-font-smoothing: antialiased;
        }
        h1,
        h3 {
            font-weight: 300;
        }
        h1 {
            color: #636363;
        }
        h3 {
            color: #4a89dc;
        }
        hgroup {
            text-align: center;
            margin-top: 4em;
        }
        form {
            width: 380px;
            margin: 2em auto;
            padding: 3em 2em 2em 2em;
            background: #fafafa;
            border: 1px solid #ebebeb;
            box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 1px 0px, rgba(0, 0, 0, 0.09804) 0px 1px 2px 0px;
        }
        paper-checkbox {
            margin: 1em 0px 0px 0px;
            /* Checked state colors. */
            --paper-checkbox-checked-color: #4285f4;
            --paper-checkbox-checked-ink-color: #4285f4;
        }
        .submit-normal {
            background: #4285f4;
            color: white;
        }
        .submit-error {
            background: #D32F2F;
            color: white;
        }
        input[is="iron-input"] {
            font: inherit;
            outline: none;
            box-shadow: none;
            border: none;
            width: 100%;
        }
    </style>

</head>

<body unresolved class="fullbleed">

    <hgroup>
        <h1>Application Login</h1>
        <h3>Please provide valid credentials.</h3>
    </hgroup>

    <form id="form" is="iron-form" action="login" method="post">
        <div class="vertical-section">
            <paper-input-container id="decorator">
                <label>User name</label>
                <input id="in-username" is="iron-input" type="text" name="username" required prevent-invalid-input/>
            </paper-input-container>

            <paper-input-container id="decorator">
                <label>Password</label>
                <input id="in-passwd" is="iron-input" type="password" name="passwd" required prevent-invalid-input/>
            </paper-input-container>

            <paper-checkbox id="in-trusted-device-mock">Trusted device?</paper-checkbox>
            <input id="in-trusted-device" type="hidden" name="trustedDevice">
        </div>

        <paper-button id="submitButton" style="width:100%" class="submit-normal" raised>
            <span id="submitLabel">Login</span>
        </paper-button>
    </form>

    <script>
        (function () {
            var form = document.getElementById('form');
            form.reset();

            var submit = document.getElementById('submitButton');
            var submitLabel = document.getElementById('submitLabel');
            var trustedDevice = document.querySelector('#in-trusted-device');
            var trustedDeviceMock = document.querySelector('#in-trusted-device-mock');

            submit.onclick = function () {
                // need to transfer value from a paper-checkbox that does not get submitted in the from
                // to a hidden input that does
                trustedDevice.value = trustedDeviceMock.checked;
                console.log("about to start submitting...");
                submit.disabled = true;
                form.submit();
            }


            form.addEventListener('iron-form-submit', function (event) {
                console.log("submitting...");
            });

            form.addEventListener('iron-form-response',
                function (event) {
                    console.log('RESPONSE event: ', event);
                    console.log('Login response code: ', event.detail.status);
                    console.log('\tresponse: ', event.detail);

                    submit.classList.remove("submit-error");
                    submitLabel.innerHTML = "Success";
                    window.location.href = "/"
                }
            );


            form.addEventListener('iron-form-error',
                function (event) {
                    console.log('ERROR event: ', event);
                    console.log('Login response code: ', event.detail.status);
                    console.log('\tresponse: ', event.detail);

                    submit.classList.add("submit-error");
                    submitLabel.innerHTML = "Try Again"
                    submit.disabled = false;
                }
            );

        })();
    </script>
</body>

</html>