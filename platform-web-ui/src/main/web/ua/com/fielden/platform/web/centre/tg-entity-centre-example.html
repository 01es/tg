<!doctype html>
<html>

<head>
    <title>TG Example</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="/resources/polymer/webcomponentsjs/webcomponents.js"></script>

    <link rel="import" href="/resources/polymer/core-toolbar/core-toolbar.html">
    <link rel="import" href="/resources/polymer/core-menu/core-menu.html">
    <link rel="import" href="/resources/polymer/core-scaffold/core-scaffold.html">
    <link rel="import" href="/resources/polymer/core-item/core-item.html">
    <link rel="import" href="/resources/polymer/paper-button/paper-button.html">
    <link rel="import" href="/resources/polymer/font-roboto/roboto.html">
    <link rel="import" href="/resources/centre/tg-entity-centre-for-TgPersistentEntityWithProperties.html">
    <link rel="import" href="/resources/polymer/flatiron-director/flatiron-director.html">
    <link rel="import" href="/resources/polymer/core-animated-pages/core-animated-pages.html">
    <link rel="import" href="/resources/polymer/core-animated-pages/transitions/slide-from-right.html">
    <link rel="import" href="/resources/element_loader/load-element.html">

    <style>
        core-animated-pages {
            width: 100%;
            height: 100%;
            background-color: white;
        }
        body {
            font-family: "RobotoDraft";
        }
        core-toolbar {
            background-color: #0288D1;
            color: #fff;
        }
        ::shadow core-toolbar {
            background-color: #0288D1;
            color: #fff;
        }
    </style>

</head>

<body unresolved fullbleed>
    <template id="centre_example" is="auto-binding">
        <flatiron-director route="{{route}}" autohash></flatiron-director>
        <core-scaffold id="scaffold" responsiveWidth="767px">

            <nav>
                <core-toolbar>TG Example</core-toolbar>
                <core-menu selected="{{route}}" valueattr="hash">
                    <core-item hash="centre" label="Entity Centre"></core-item>
                    <core-item hash="master" label="Entity Master"></core-item>
                </core-menu>
            </nav>

            <core-toolbar style="font-size: 20px;" tool>
                <div>{{route === 'centre' ? 'Entity Centre' : 'Entity Master'}}</div>
            </core-toolbar>

            <core-animated-pages selected="{{route}}" valueattr="id" transitions="slide-from-right">
                <tg-entity-centre-for-TgPersistentEntityWithProperties id="centre" user="SU"></tg-entity-centre-for-TgPersistentEntityWithProperties>
                <load-element id="master" import="{{componentUri}}" elementName="{{elementName}}" attrs="{{attrs}}" on-after-load="{{onMasterLoaded}}" auto></load-element>
            </core-animated-pages>

        </core-scaffold>

    </template>



    <script>
        (function () {
            var centreExample = document.querySelector("#centre_example");

            centreExample.route = 'centre';

            centreExample.componentUri = "/users/{{user}}/master/ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties";
            centreExample.elementName = "tg-TgPersistentEntityWithProperties-master";
            centreExample.attrs = {
                user: 'SU',
                entityid: 15,
                entitytype: 'ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties',
                currentState: 'VIEW'
            };

            centreExample.onMasterLoaded = function (e, detail, source) {
                detail.onRetrieved = function(entity, bindingEntity, customObject) {
                    console.log("onRetrieved");
                };

                detail.onValidated = function(validatedEntity, bindingEntity, customObject) {
                    console.log("onValidated");
                };

                detail.onSaved = function(potentiallySavedEntity, newBindingEntity) {
                    console.log("onSaved");
                };
                
                detail.retrieve();
            };

            centreExample.addEventListener('template-bound', function (e) {
                this.route = this.route || "centre";
                
                console.log("-----------------------ready--------------------------------", document.querySelector("#centre"));
                document.querySelector("#centre").retrieve();
            });
        })();
    </script>

</body>

</html>
