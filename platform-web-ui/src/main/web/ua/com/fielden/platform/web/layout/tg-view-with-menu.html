<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/resources/polymer/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="/resources/polymer/core-toolbar/core-toolbar.html">
<link rel="import" href="/resources/polymer/core-icon-button/core-icon-button.html">
<link rel="import" href="/resources/element_loader/load-element.html">
<link rel="import" href="/resources/polymer/core-menu/core-menu.html">
<link rel="import" href="/resources/polymer/core-icon/core-icon.html">
<link rel="import" href="/resources/polymer/paper-item/paper-item.html">
<link rel="import" href="/resources/polymer/core-scaffold/core-scaffold.html">
<link rel="import" href="/resources/polymer/paper-shadow/paper-shadow.html">

<polymer-element name="tg-view-with-menu" attributes="label pages childRoute">
    <template>
        <style>
            core-animated-pages {
                width: 85%;
                height: 85%;
                border: none;
                -webkit-user-select: none;
                border-radius: 5px;
                transform: translateZ(0);
            }
            core-animated-pages > * {
                border-radius: inherit;
                background-color: white;
            }
            core-toolbar {
                background-color: #03a9f4;
                color: #fff;
            }
            ::shadow core-toolbar {
                background-color: #03a9f4;
                color: #fff;
            }
            core-menu {
                color: #01579b;
                margin: 10px 0 0 0;
            }
            core-menu > paper-item {
                transition: all 300ms ease-in-out;
            }
            paper-item a {
                text-decoration: none;
                color: currentcolor;
                margin-left: 5px;
            }
            core-menu > paper-item.core-selected {
                background: #e1f5fe;
            }
        </style>

        <core-scaffold id="scaffold">

            <nav>
                <core-toolbar>{{label}}</core-toolbar>
                <core-menu selected="{{route}}" valueattr="hash" selectedmodel="{{selectedPage}}" on-core-select="{{menuItemSelected}}">
                    <template repeat="{{page in pages}}">
                        <paper-item noink hash="{{page.hash}}">
                            <core-icon icon="label{{route != page.hash ? '-outline' : ''}}"></core-icon>
                            <a href="#{{page.hash}}">{{page.name}}</a>
                        </paper-item>
                    </template>
                </core-menu>
            </nav>

            <core-toolbar tool flex>
                <div flex>{{selectedPage.page.name}}</div>
            </core-toolbar>

            <div layout horizontal center-center center-justified fit>
                <core-animated-pages selected="{{route}}" valueattr="hash" transitions="slide-from-right">
                    <template repeat="{{page in pages}}">
                        <paper-shadow z="1" hash="{{page.hash}}" fit>
                            <load-element import="{{page.url}}" attrs="{{page.attributes}}" auto>Loading {{page.name}}...</load-element>
                        </paper-shadow>
                    </template>
                </core-animated-pages>
            </div>

        </core-scaffold>
        5
    </template>
    <script>
        Polymer({
            attached: function () {
                if (this.pages && this.pages.length) {
                    this.route = this.route || this.pages[0].hash;
                }
            },
            childRouteChanged: function (oldValue, newValue) {
                var splittedRoute;
                if (newValue && newValue.length) {
                    splittedRoute = newValue.split("/");
                    if (splittedRoute.length) {
                        this.route = splittedRoute[0];
                    } else {
                        this.route = 0;
                    }
                    if (splittedRoute.length > 1) {
                        this.remainingRoute = splittedRoute.splice(1, splittedRoute.length - 1);
                    } else {
                        this.remainingRoute = null;
                    }
                }
            },
            menuItemSelected: function (e, detail, sender) {
                if (detail.isSelected) {
                    this.$.scaffold.closeDrawer();
                }
            }
        });
    </script>
</polymer-element>