<!doctype html>
<html>

<head>
    <title>Entity Centre Example</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="/resources/polymer/webcomponentsjs/webcomponents.js"></script>

    <link rel="import" href="/resources/polymer/core-ajax/core-ajax.html">
    <link rel="import" href="/resources/polymer/core-toolbar/core-toolbar.html">
    <link rel="import" href="/resources/polymer/core-header-panel/core-header-panel.html">
    <link rel="import" href="/resources/polymer/font-roboto/roboto.html">
    <link rel="import" href="/resources/centre/tg-entity-centre.html">
    <link rel="import" href="/resources/serialisation/tg-serialiser.html">
    <link rel="import" href="/resources/polymer/paper-button/paper-button.html">

    <style>
        body {
            font-family: "RobotoDraft";
        }
        core-toolbar {
            background-color: #03a9f4;
            color: #fff;
        }
    </style>

</head>

<body unresolved fullbleed layout vertical>

    <template id="centre_example" is="auto-binding">
        <tg-serialiser id="serialiser"></tg-serialiser>

        <core-header-panel mode="cover" flex>
            <core-toolbar>Entity centre</core-toolbar>
            <div>
                <tg-entity-centre id="centre"></tg-entity-centre>
            </div>
            <core-ajax id="config_retriever" url="/users/SU/centre/{{centreName}}" handleas="json" on-core-response="{{onCritLoadResponse}}" on-core-error="{{onCritLoadError}}"></core-ajax>
        </core-header-panel>

        <paper-button id="runner" raised roll="button" on-tap="{{run}}">Run</paper-button>
    </template>

    <script>
        (function () {
            var centre = document.querySelector('#centre_example');
            centre.centreName = "ua.com.fielden.platform.sample.domain.MiTgPersistentEntityWithProperties";
            centre.onCritLoadResponse = function(e, detail, sender) {
                console.log(detail.response);
                console.log('detail.response["@instanceType"]', detail.response['@instanceType']);
                console.log('detail.response["instance"]', detail.response['instance']);

                var deserialisedResult = centre.$.serialiser.deserialise(e.detail.response);
                console.log("deserialisedResult", deserialisedResult);
            };
            centre.onCritLoadError = function(e, detail, sender) {
                console.log("error loading centre");
            };
            centre.run = function() {
                // centre.$.config_retriever.go();
                console.log("centre.$.centre =", centre.$.centre);
                console.log("centre.$.centre.$ =", centre.$.centre.$);
                centre.$.centre.$.selection_criteria.retrieve();
            };
            
            document.addEventListener('polymer-ready', function () {
                //TODO finish example
            });

        })();
    </script>

</body>

</html>
