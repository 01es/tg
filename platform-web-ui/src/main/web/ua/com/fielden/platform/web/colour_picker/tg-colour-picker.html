<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/polymer/iron-icons/editor-icons.html">
<link rel="import" href="/resources/polymer/iron-icons/iron-icons.html">
<link rel="import" href="/resources/polymer/paper-input/paper-input.html">
<link rel="import" href="/resources/polymer/paper-input/paper-input-container.html">
<link rel="import" href="/resources/polymer/iron-dropdown/iron-dropdown.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">

<dom-module id="tg-colour-picker">
	<style>
		.color-box {
			width: 40px;
			height: 40px;
			background-color: #ccc;
		}
		
		.small-box {
			min-width: 18px;
			height: 18px;
			background-color: #F44336;
			border-radius: 3px;
		}
		/*
		a { width: 40px; height: 40px; background-color: #fff; opacity: 0; }
*/
		
		a:hover {
			box-shadow: 0px 2px 10px #ccc;
			border: 3px solid #fff;
			/*			position: absolute;*/
		}
		
		paper-input-container {
			padding: 0.2em;
			font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
			--paper-input-container-input-color: #212121;
		}
		
		iron-dropdown {
			font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
			background-color: #FAFAFA;
			color: var(--google-grey-700);
			box-shadow: 0px 2px 6px #ccc;
			margin-top: 53px;
			margin-left: 5px;
		}
		
		paper-icon-button {
			align-self: flex-end;
			--iron-icon-height: 1em;
			--iron-icon-width: 1em;
			padding-left: 4px;
			padding-right: 2px;
			padding-top: 2px;
			padding-bottom: 2px;
		}
	</style>

	<template>

		<paper-input-container always-float-label>
			<div class="layout horizontal center">
				<!--				<paper-icon-button icon="editor:format-color-fill" title="Colour editor" id="fab" on-tap="open"></paper-icon-button>-->
				<div on-tap="open" class="small-box" style$="[[_calcColorBoxStyle(color)]]"></div>
				<label>Hex code colour value</label>
				<!--				<div prefix>#</div>-->
				<input bind-value="{{color}}" value="{{color::input}}" is="iron-input" style$="[[_calcColorTextStyle(color)]]" prevent-invalid-input allowed-pattern="[0-9# A-F a-f]" maxlength="7" id='inputWithButton'>

				<paper-input-error>Hex code colour value only(#,0-9,A-F)!</paper-input-error>

			</div>

		</paper-input-container>

		<iron-dropdown positionTarget="fab" id="dropdown">
			<div class="dropdown-content">

				<div class="layout vertical" style="margin:10px 10px 10px 10px;">
					<div class="layout horizontal">
						<!--						<div class="color-box" on-tap="colorSelected" style="background-color: #F44336;"></div>-->
						<a class="color-box" on-tap="colorSelected" style="background-color: #F44336;"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color:#FF9800"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color:#FFEB3B"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color:#4CAF50"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #009688"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color:#00BCD4"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #3F51B5"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #9C27B0"></a>
					</div>
					<div class="layout horizontal">
						<a class="color-box" on-tap="colorSelected" style="background-color: #EF9A9A"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #FFCC80"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #FFF59D"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #A5D6A7"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #80CBC4"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #80DEEA"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #9FA8DA"></a>
						<a class="color-box" on-tap="colorSelected" style="background-color: #CE93D8"></a>
					</div>
					<!--
					<div style="width: 40px;height: 40px; background-color: #fff; box-shadow: 0px 2px 6px #ccc;">
						<div style="width: 30px;height: 30px;background-color: red; margin-left: 5px; margin-top:5px;">
						</div>
					</div>
-->
				</div>
		</iron-dropdown>


	</template>
</dom-module>
<script>
	Polymer({
		is: "tg-colour-picker",
		properties: {
			color: {
				type: String,
				notify: true
			},

		},

		colorSelected: function (e, detail) {
			this.color = rgbToHex(e.srcElement.style['background-color']);
			this.$.dropdown.close();
		},

		_calcColorBoxStyle: function (color) {
			return "background-color: " + color;
		},
		_calcColorTextStyle: function (color) {
			if (color.length === 4 || color.length === 7) {
				return "margin-left: 10px; color: #212121; ";
			} else {
				return "margin-left: 10px; color: #DD2C00";
			}
		},
		open: function () {
			this.$.dropdown.open();
		},

	});

	function rgbToHex(color) {
		if (color.substr(0, 1) === "#") {
			return color;
		}
		var nums = /(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(color),
			r = parseInt(nums[2], 10).toString(16),
			g = parseInt(nums[3], 10).toString(16),
			b = parseInt(nums[4], 10).toString(16);
		return "#" + (
			(r.length == 1 ? "0" + r : r) +
			(g.length == 1 ? "0" + g : g) +
			(b.length == 1 ? "0" + b : b)
		);
	}
</script>