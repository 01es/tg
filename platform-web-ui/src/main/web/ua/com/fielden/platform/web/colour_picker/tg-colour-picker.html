<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/polymer/iron-icons/editor-icons.html">
<link rel="import" href="/resources/polymer/iron-icons/iron-icons.html">
<link rel="import" href="/resources/polymer/paper-input/paper-input.html">
<link rel="import" href="/resources/polymer/paper-input/paper-input-container.html">
<link rel="import" href="/resources/polymer/iron-dropdown/iron-dropdown.html">
<link rel="import" href="/resources/polymer/paper-button/paper-button.html">

<dom-module id="tg-colour-picker">
	<style>
		.color-box {
			width: 40px;
			height: 40px;
			background-color: #ccc;
		}
		
		.small-box {
			min-width: 18px;
			height: 18px;
			background-color: #ccc;
			box-shadow: 0px 2px 6px #ccc;
		}
		
		paper-input-container {
			padding: 0.2em;
			font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
			--paper-input-container-input-color: #212121;
		}
		
		iron-dropdown {
			font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
			background-color: #FAFAFA;
			color: var(--google-grey-700);
			box-shadow: 0px 2px 6px #ccc;
			margin-top: 53px;
			margin-left: 5px;
		}
		
		paper-icon-button {
			align-self: flex-end;
			--iron-icon-height: 1em;
			--iron-icon-width: 1em;
			padding-left: 4px;
			padding-right: 2px;
			padding-top: 2px;
			padding-bottom: 2px;
		}
	</style>

	<template>

		<paper-input-container always-float-label>
			<div class="layout horizontal center">
				<!--				<paper-icon-button icon="editor:format-color-fill" title="Colour editor" id="fab" on-tap="open"></paper-icon-button>-->
				<div on-tap="open" class="small-box" style$="[[_calcColorBoxStyle(color)]]"></div>
				<label>Hex code colour value</label>
				<input bind-value="{{color}}" value="{{color::input}}" is="iron-input" style="margin-left:10px;" prevent-invalid-input allowed-pattern="[0-9# A-F a-f]" maxlength="7">
				<!--				<paper-input-error>Hex code colour value only(#,0-9,A-F)!</paper-input-error>-->

			</div>

		</paper-input-container>

		<iron-dropdown positionTarget="fab" id="dropdown">
			<div class="dropdown-content">

				<div class="layout vertical" style="margin:10px 10px 10px 10px;">
					<div class="layout horizontal">
						<div class="color-box" on-tap="colorSelected" mouseover="" mouseleave="" style="background-color: #F44336; border-color: white; border-width: 2px; box-shadow: 0px 2px 4px #ccc;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #FF9800;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #FFEB3B;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #4CAF50;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #009688;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #00BCD4;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #3F51B5;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #9C27B0;"></div>
					</div>
					<div class="layout horizontal">
						<div class="color-box" on-tap="colorSelected" style="background-color: #EF9A9A;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #FFCC80;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #FFF59D;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #A5D6A7;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #80CBC4;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #80DEEA;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #9FA8DA;"></div>
						<div class="color-box" on-tap="colorSelected" style="background-color: #CE93D8;"></div>
					</div>
				</div>
			</div>
		</iron-dropdown>


	</template>
</dom-module>
<script>
	Polymer({
		is: "tg-colour-picker",
		properties: {
			color: {
				type: String,
				notify: true
			}
		},
		//		overFocuseColor: function (e, detail) {
		//			e.srcElement.style['border-color'] =
		//		}

		colorSelected: function (e, detail) {
			this.color = rgbToHex(e.srcElement.style['background-color']);
			dropdown.close;
		},
		_calcColorBoxStyle: function (color) {
			return "background-color: " + color;
		},
		open: function () {
			this.$.dropdown.open();
		}
	});

	function rgbToHex(color) {
		if (color.substr(0, 1) === "#") {
			return color;
		}
		var nums = /(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(color),
			r = parseInt(nums[2], 10).toString(16),
			g = parseInt(nums[3], 10).toString(16),
			b = parseInt(nums[4], 10).toString(16);
		return "#" + (
			(r.length == 1 ? "0" + r : r) +
			(g.length == 1 ? "0" + g : g) +
			(b.length == 1 ? "0" + b : b)
		);
	}
</script>